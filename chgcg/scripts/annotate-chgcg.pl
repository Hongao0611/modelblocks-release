###############################################################################
##                                                                           ##
## This file is part of ModelBlocks. Copyright 2009, ModelBlocks developers. ##
##                                                                           ##
##    ModelBlocks is free software: you can redistribute it and/or modify    ##
##    it under the terms of the GNU General Public License as published by   ##
##    the Free Software Foundation, either version 3 of the License, or      ##
##    (at your option) any later version.                                    ##
##                                                                           ##
##    ModelBlocks is distributed in the hope that it will be useful,         ##
##    but WITHOUT ANY WARRANTY; without even the implied warranty of         ##
##    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the          ##
##    GNU General Public License for more details.                           ##
##                                                                           ##
##    You should have received a copy of the GNU General Public License      ##
##    along with ModelBlocks.  If not, see <http://www.gnu.org/licenses/>.   ##
##                                                                           ##
###############################################################################

use Getopt::Std;

getopts("d");

$DEBUG = 0;
if ($opt_d) {
  $DEBUG = 1;
}

sub debug {
  if ($DEBUG) {
    $msg = $_[1];
    print stderr $_[0] , " " , $msg, "\n";
  }
  return 0
}



#### NOTE!
#s/-[mnp]Q//g;

## for each tree...
while ( <> ) {
	s/ +/ /g;

  $line++;  if ($line % 1000 == 0) { print stderr "$line lines processed...\n"; }
  
  #### category normalization
  # root category
#?? is headline treated differently in English?
  s/^\((IP |IP-HLN |IP-IMP |IP-Q )/\(V /;
##??delete extra space why cannot work
  s/\) \)/\)\)/g;
#  s/\^(.*)\] +\^/\^\1\]\^/g;
#  

 
  

  ######################################################################
  ## II. TOP-DOWN: REANNOTATE TO PSG FORMAT

  ## mark top-level constituent as current...
  s/^ *\((.*)\) *$/\^\1\^/;
  ## mark all other constituents as internal...
  s/\(/\[/g;
  s/\)/\]/g;
  s/\] +\] +\]/\]\]\]/g;
  s/\] +\]/\]\]/g;
  s/\] +>/\]>/g;
  
  
  ## for each constituent...
  while ( $_ =~ /\^/ ) {
    ## mark all children of current...
    for ( $i=index($_,'^'),$d=0; $i<rindex($_,'^'); $i++ ) {
      if ( substr($_,$i,1)eq'[' ) { if($d==0){substr($_,$i,1)='<';} $d++; }
      if ( substr($_,$i,1)eq']' ) { $d--; if($d==0){substr($_,$i,1)='>';} }
    }
    #################### ADD SED RULES HERE: apply rules to angles (children) within braces (consituent)...
    debug(++$step, "   $_");


    
    ######################################################################
    ## B. BRANCH OFF MODIFIERS AND ARGUMENTS IN ORDER OF PRECEDENCE

    #### only one rewrite rule may apply at any node (recurse only if new node created)
    #### rewrite rules are ordered by precedence: rules preferred at higher nodes are first
    $j = 0;
    if (
        debug($step, ".. $_") ||
	#RNR
	s/\^(V-aN-gN) +<VP +([^>]*)> <NP[^ ]* +([^>]*)>\^/\^\1 <V-aN-gN \2> <N \3>\^/&&($j=rnr4)||

	s/\^(V[^ ]*) +<(VP +[^>]*)\[(NP[^ ]*) +(\[-NONE- \*RNR\*-)(\d+)([^>]*)> +<(CC +[^>]*)> +<(VP +[^>]*)(\[\3-\5 [^>]*)>\^/<\1 [VP [\2\[\3 \4\5\6] [\7] [\8\[\3 \4\5\6]] \9>/&&($j=rnr1)||
	s/\^(Q-bN) +<(QP +[^>]*)\[(CLP[^ ]*) +(\[-NONE- \*RNR\*-)(\d+)([^>]*)> +(<CC +[^>]*>|<PU +[^>]*>)( <QP[^>]*> <PU[^>]*>) +<(QP[^ ]* +[^>]*)(\[\3-\5 [^>]*)>\^/<\1 [QP [\2\[\3 \4\5\6] \7\8 [\9\[\3 \4\5\6]] $10>/&&($j=rnr5)||
	s/\^(Q-bN) +<(QP +[^>]*)\[(CLP[^ ]*) +(\[-NONE- \*RNR\*-)(\d+)([^>]*)> +(<CC +[^>]*>|<PU +[^>]*>)( <QP[^>]*> <CC[^>]*>) +<(QP[^ ]* +[^>]*)(\[\3-\5 [^>]*)>\^/<\1 [QP [\2\[\3 \4\5\6] \7\8 [\9\[\3 \4\5\6]] $10>/&&($j=rnr5)||

	s/\^(Q-bN|Q) +<(QP +[^>]*)\[(CLP[^ ]*) +(\[-NONE- \*RNR\*-)(\d+)([^>]*)> +(<CC +[^>]*>|<PU +[^>]*>) +<(QP[^ ]* +[^>]*)(\[\3-\5 [^>]*)>\^/<\1 [QP [\2\[\3 \4\5\6] \7 [\8\[\3 \4\5\6]] \9>/&&($j=rnr2)||
	s/\^(Q-bN|Q) +<(QP +[^>]*)\[(CLP[^ ]*) +(\[-NONE- \*T\*-)(\d+)([^>]*)> +(<CC +[^>]*>|<PU +[^>]*>) +<(QP[^ ]* +[^>]*)(\[\3-\5 [^>]*)>\^/<\1 [QP [\2\[\3 \4\5\6] \7 [\8\[\3 \4\5\6]] \9>/&&($j=rnr4)||

	s/\^(V[^ ]*) +<(VP +[^>]*)\[(NP[^ ]*) +(\[-NONE- \*RNR\*-)(\d+)([^>]*)> +<(PU +[^>]*)> +<(VP +[^>]*)\[(NP[^ ]*) +(\[-NONE- \*RNR\*-)(\d+)([^>]*)> +<(PU +[^>]*)> +<(VP +[^>]*)\[(NP[^ ]*) +(\[-NONE- \*RNR\*-)(\d+)([^>]*)> +<(PU +[^>]*)> +<(VP +[^>]*)(\[\3-\5 [^>]*)>\^/<\1 [VP [\2\[\3 \4\5\6] [\7] [\8\[\3 \4\5\6] [\7] [$14\[\3 \4\5\6] [\7] [$20\[\3 \4\5\6]] $21>/&&($j=rnr3)||
	s/\^(V-aN-bN) +<VV +([^>]*)> +(<CC +[^>]*>) +(<VV +[^>]*>)\^/\^\1 <\1 \2> <\1-c{\1} \3 \4>\^/&&($j=136)||
	s/\^(V-aN-bN) +<VP +([^>]*)> +(<PU +[^>]*>) +(<VP +[^>]*>)(.*)\^/\^\1 <\1 \2> <\1-c{\1} \3 \4\5>\^/&&($j=416)||
	s/\^(V-aN-bN-c{V-aN-bN}) +(<PU +[^>]*>) +(<VP +[^>]*\*RNR\*[^>]*>)(.*)\^/\^\1 \2 <V-aN-bN \3\4>\^/&&($j=417)||
	s/\^(V-aN-bN-c{V-aN-bN}) +<CC +([^>]*)> +<VV +([^>]*)>\^/\^\1 <V-aN-bN-c{V-aN-bN}-d{V-aN-bN} \2> <V-aN-bN \3>\^/&&($j=137)||
	s/\^(V-aN-b{V-aN}-bN) +<VP +([^>]*)> +(<CC +[^>]*>) +(<VP +[^>]*>)\^/\^\1 <\1 \2> <\1-c{\1} \3 \4>\^/&&($j=144)||
	s/\^(V-aN-b{V-aN}-bN-c{V-aN-b{V-aN}-bN}) +<CC +([^>]*)> +<VP +([^>]*)>\^/\^\1 <(V-aN-b{V-aN}-bN-c{V-aN-b{V-aN}-bN}-d{V-aN-b{V-aN}-bN} \2> <V-aN-b{V-aN}-bN \3>\^/&&($j=145)||
	#correcting nonexsiting gapping structure:ugly!!!
	s/\^(V-aN) +<VP +\[(V[^ ]*[^\]]*)\] (\[NP-OBJ\=)(\d) ([^>]*)\> (<PU[^>]*>) <VP \[NP-OBJ\=\4 ([^>]*)> (<PU[^>]*>) <VP \[NP-OBJ\=\4 ([^>]*)> (<PU[^>]*>) <VP \[NP-OBJ\=\4 ([^>]*)>\^/<\1 [VP [\2] [NP-OBJ [NP [NP \5] \6 [NP [NP \7] \8 [NP [NP \9] $10 [NP [NP $11]]]>/&&($j=gap4)||
	s/\^(V-aN) +<VP +\[(V[^ ]*[^\]]*)\] (\[NP-OBJ\=)(\d) ([^>]*)\> (<PU[^>]*>) <VP \[NP-OBJ\=\4 ([^>]*)> (<PU[^>]*>) <VP \[NP-OBJ\=\4 ([^>]*)>\^/<\1 [VP [\2] [NP-OBJ [NP [NP \5] \6 [NP [NP \7] \8 [NP [NP \9]]]>/&&($j=gap3)||
 
	s/\^(V-aN) +<VP +\[(V[^ ]*[^\]]*)\] (\[NP-OBJ\=)(\d) ([^>]*)\> (<PU[^>]*>) <VP \[NP-OBJ\=\4 ([^>]*)> (.*)\^/<\1 [VP [\2] [NP-OBJ [NP [NP \5] \6 [NP [NP \7]]] \8>/&&($j=gap2)||
	#some gappings are not annotated with numbers!
	#s/\^(V-aN) +(<VP +\[V[^>]*NP-SBJ \[-NONE- \*PRO\*[^>]*\>) (<PU[^>]*>) (<VP \[NP-OBJ[^>]*NP-SBJ \[-NONE- \*PRO\*[^>]*>) (.*)\^/\^\1 <\1 \2 \3> <\1 \4 \5>\^/&&($j=557)||

	s/\^(V-aN) +<VP +\[(V[^ ]*[^\]]*)\] (\[NP-OBJ) ([^>]*)\> (<PU[^>]*>) <VP \[NP-OBJ ([^>]*)> (.*)\^/<\1 [VP [\2] [NP-OBJ [NP [NP \4] \5 [NP [NP \6]]] \7>/&&($j=gap4)||

	#delete RNR NP
	s/\^(V-aN-bN) +<VP +([^>]*\*RNR\*[^>]*)>\^/<\1 \2>/&&($j=141)||
	s/\^(V-aN-b{V-aN}-bN) +<VV +([^>]*)> +<NP[^>]*\*RNR\*[^>]*> +<IP[^>]*\*RNR\*[^>]*>\^/<\1 \2>/&&($j=146)||
	s/\^(V-aN-bN) +<(VV|VCD) +([^>]*)> +<NP[^>]*\*RNR\*[^>]*>\^/\^\1 <\1 \3>\^/&&($j=139)||
	s/\^(V-aN-gN) +<(VV|VCD) +([^>]*)> +<NP[^>]*\*RNR\*[^>]*>\^/\^\1 <V-aN-bN \3>\^/&&($j=505)||
	#s/\^(Q-bN) +<QP +([^>]*\*RNR\*[^>]*)> +(<CLP[^ ]* +[^>]*>)\^/<\1 \2 \3>/&&($j=292)||
	s/\^(Q-bN) +<QP +([^>]*\*RNR\*[^>]*)> +<CLP[^ ]* +([^>]*)>\^/\^\1 <C \2> <Q-bN-aC \3>\^/&&($j=291)||
	s/\^(Q-bN) +<QP +([^>]*\*T\*[^>]*)> +<CLP[^ ]* +([^>]*)>\^/\^\1 <C \2> <Q-bN-aC \3>\^/&&($j=598)||

	s/\^(Q) +<QP +([^>]*\*RNR\*[^>]*|[^>]*\*T\*[^>]*)> +<CLP[^ ]* +([^>]*)>\^/\^\1 <C \2> <Q-aC \3>\^/&&($j=345)||
	s/\^(C) +<QP +([^>]*\*RNR\*[^>]*)> +(<CC[^>]*>|<PU[^>]*>) +(<QP[^ ]* +[^>]*\*RNR\*[^>]*>)(.*)\^/\^\1 <C \2> <C-cC \3 \4\5>\^/&&($j=292)||
	s/\^(C) +<QP +([^>]*\*T\*[^>]*)> +(<CC[^>]*>|<PU[^>]*>) +(<QP[^ ]* +[^>]*\*T\*[^>]*>)\^/\^\1 <C \2> <C-cC \3 \4>\^/&&($j=599)||

	s/\^(C) +<(CD|OD) +([^>]*)> +<CLP +([^>]*\*RNR\*[^>]*)>\^/<C \3>/&&($j=293)||
	s/\^(C) +<CD +([^>]*)> +<CLP +([^>]*\*T\*[^>]*)>\^/<C \2>/&&($j=600)||
	s/\^(C) +<QP +([^>]*CLP +[^>]*\*RNR\*[^>]*)>\^/<C \2>/&&($j=601)||

	s/\^(C-cC) <CC +([^>]*)> +<QP[^ ]* +([^>]*\*RNR\*[^>]*)>\^/\^\1 <C-cC-dC \2> <C \3>\^/&&($j=294)||
	s/\^(C-cC) <CC +([^>]*)> +<QP[^ ]* +([^>]*\*T\*[^>]*)>\^/\^\1 <C-cC-dC \2> <C \3>\^/&&($j=601)||

	s/\^(C-cC) (<PU +[^>]*>) +(<QP[^ ]* +[^>]*\*RNR\*[^>]*>)(.*)\^/\^\1 <C-cC-dC \2> <C \3\4>\^/&&($j=529)||

	#V (IP..)...(PU...) --> S-fIP(V..)(PU... )
	s/\^(V) +(.*)(<IP.*>) +(<PU[^>]*>)\^/\^V <\1 \2\3> \4\^/&&($j=13)||
	s/\^(V[^ ]*) +(.*) +(<PU[^>]*>)\^/\^\1 <\1 \2> \3\^/&&($j=202)||
        #V-fIP (IP ...) (PU...) (IP ...) --> V-fIP (V-fIP)(V-cV)
	s/\^(V-aN) +(<IP +[^>]*>) +(<PU[^>]*>) +<IP (\[ADVP \[AD 以便[^>]*)>\^/\^\1 <\1 \2 \3> <R-bV [V \4]>\^/&&($j=400)||
	s/\^(V) +(<IP +[^>]*>) +(<PU[^>]*>) +(<PP[^ ]* +[^>]*>)\^/\^\1 <\1 \2 \3> <R-bV \4>\^/&&($j=541)||

	s/\^(V) +<(IP +[^>]*)> +(<PU[^>]*>)(.*)\^/\^\1 <\1 [\2]> <\1-c\{\1\} \3\4>\^/&&($j=14)||
	s/\^(V) +<(IP +[^>]*)> +(<IP[^>]*>)(.*)\^/\^\1 <\1 [\2]> <\1-c\{\1\} \[\1 \3\4\]>\^/&&($j=355)||
	s/\^(V[^ ]*)-c([^ ]*) +<(PU[^>]*)> +(<IP[^>]*>)(.*)\^/\^\1-c\2 <\3> <\1 \4\5>\^/&&($j=34)||
	s/\^(V-aN[^ ]*) +(<VP[^>]*> +<PU[^>]*>) +<VP +(\[MSP[^>]*)>\^/\^\1 <\1 \2> <R-bV \3>\^/&&($j=228)||
	s/\^(V-aN[^ ]*) +(<VP[^>]*> +<PU[^>]*> +<VP-PRP +\[AD[^ ]*[^>]*>) +(<PU[^>]*> +<VP[^>]*>)\^/\^\1 <\1 \2> <V-aN-c{V-aN} \3>\^/&&($j=287)||
	s/\^(V-aN[^ ]*) +(<VP[^>]*> +<PU[^>]*>) +<VP-PRP +(\[AD[^ ]*[^>]*)>(.*)\^/\^\1 <\1 \2> <R-bV \3>\^/&&($j=270)||
	s/\^(V-aN) +(<VP[^>]*>) +(<PU[^>]*>) +(<CC[^>]*>) +(<VP[^>]*>)(.*)\^/\^\1 <\1 \2 \3> <\1-c\{\1\} \4 \5\6>\^/&&($j=454)||
	s/\^(V-aN-gN) +(<VP +[^>]*>) +(<PU[^>]*>) +(<CC[^>]*>) +(.*-NONE- \*T\*.*)\^/\^\1 <V-aN \2 \3> <\1-c{V-aN} \4 \5>\^/&&($j=464)||
	s/\^(V-aN-gN-c{V-aN}) +<CC +([^>]*)> +(.*-NONE- \*T\*.*)\^/\^\1 <\1-d{V-aN-gN} \2> <V-aN-gN \3>\^/&&($j=465)||
	s/\^(V-aN) +(<VP[^>]*>) +(<PU[^>]*>) +(<IP-OBJ +[^>]*>)\^/\^\1 <V-aN-bV \2 \3> <V \4>\^/&&($j=555)||
	s/\^(V-aN-bV) +<VP +([^>]*)> +(<PU[^>]*>)\^/\^\1 <\1 \2> \3\^/&&($j=556)||
	#break down fake gapping
	s/\^(V-aN) +<VP +([^>]*) +(\[NP-OBJ[^>]*)> +(<PU[^>]*>) +<VP (\[NP-OBJ[^>]*)>\^/<\1 \2 \[NP \[NP \3\] \4 \[NP \5]\]>/&&($j=588)||

	s/\^(V-aN) +<(VP[^>]*)> +(<PU[^>]*> +.*)\^/\^\1 <\1 [\2]> <\1-c\{\1\} \3>\^/&&($j=40)||
	s/\^(V[^ ]*)-c([^ ]*) +<(PU[^>]*)> +<(VP[^ ]*) +([^>]*)>\^/\^\1-c\2 <\3> <\1 \5>\^/&&($j=42)||
	s/\^(V[^ ]*) +<(IP +[^>]*)> +(<CC +[^>]*>) +(<IP +[^>]*>)(.*)\^/\^\1 <\1 [\2]> <\1-c\{\1\} \3 \4\5>\^/&&($j=214)||
	s/\^(V[^ ]*)-c([^ ]*) +<CC +([^>]*)> +(<IP +[^>]*>)\^/\^\1-c\2 <\1-c\2-d\2 \3> <\1 \4>\^/&&($j=215)||
	s/\^(V[^ ]*)-c([^ ]*) +<CC +([^>]*)> +(<IP +[^>]*>)(.*)\^/\^\1-c\2 <\1-c\2-d\2 \3> <\1 \4\5>\^/&&($j=324)||
	#VP coordination
	s/\^(V-aN) +(<CC +[^ ]*>) +(<VP +[^>]*>) +(<PU +[^>]*>) +(<CC +[^>]*>) +(<VP +[^>]*>)\^/\^\1 <\1 \2 \3 \4> <\1-c{\1} \5 \6>\^/&&($j=302)||
	s/\^(V-aN) +<VV +([^ ]*)> +(<PU +[^>]*>) +(<VV +[^>]*>)(.*)\^/\^\1 <\1 \2> <\1-c{\1} \3 \4\5>\^/&&($j=434)||
	s/\^(V-aN) +<CC +([^>]*)> +<VP +([^>]*)>\^/\^\1 <R-bV \2> <\1 \3>\^/&&($j=303)||
	s/\^(V-aN) +<VP +([^>]*)> +(<VP.*CC.*<VP.*)\^/\^\1 <\1 \2> <\1-c{\1} [V-aN \3]>\^/&&($j=295)||
	s/\^(V-aN) +<(VP|VA|VV) +([^>]*)> +(<CC[^>]*>) +(.*)\^/\^\1 <\1 \3> <\1-c{\1} \4 \5>\^/&&($j=95)||
	s/\^(V-aN-bN|V-aN-gN) +(<VP +[^>]*>) +(<CC[^>]*>) +(.*)\^/\^\1 <\1 \2> <\1-c{\1} \3 \4>\^/&&($j=138)||
	s/\^(V-aN)-c([^ ]*) +<CC +([^>]*)> +(.*)\^/\^\1-c\2 <\1-c\2-d\2 \3> <\1 \4>\^/&&($j=96)||
	s/\^(V-aN-bN|V-aN-gN)-c([^ ]*) +<CC +([^>]*)> +(.*)\^/\^\1-c\2 <\1-c\2-d\2 \3> <\1 \4>\^/&&($j=140)||
	s/\^(V-aN) +(<VV +[^>]*>) +(<VP +[^>]*>) +(<PU[^>]*>) +(.*)\^/\^\1 <\1 \2 \3> <V-aN-c{V-aN} \4 \5>\^/&&($j=333)||
	s/\^(V-aN-c{V-aN}) +<(PU[^>]*)> +(<VP +([^>]*)> +.*)\^/\^\1 <\2> <V-aN \3>\^/&&($j=105)||
	s/\^(V-aN) +<(VP) +([^>]*)> +(<VP +[^>]*>)(.*)\^/\^\1 <\1 \3> <\1-c{\1} \[\1 \4\5\]>\^/&&($j=115)||
	s/\^(V-aN) +<(VV) +([^>]*)> +(<VV[^>]*>)(.*)\^/\^\1 <\1 \3> <\1-c{\1} \[\1 \4\5\]>\^/&&($j=540)||

	s/\^(V-aN-gN) +<VP +([^>]*)> +(<VP +[^>]*-NONE- \*T\*[^>]*>)\^/\^\1 <V-aN \2> <\1-c{V-aN} [\1 \3]>\^/&&($j=463)||
	s/\^(V-aN|V-aN-b{V-aN}) +<VV +([^>]*)> +(<VV +[^>]*>)\^/\^\1 <\1 \2> <\1-c{\1} \3>\^/&&($j=220)||
	s/\^(V-aN) +<VV +([^>]*)> +(<VA +[^>]*>)\^/\^\1 <\1 \2> <\1-c{\1} \3>\^/&&($j=297)||
	s/\^(V-aN-c{V-aN}) +<(VA|VP)([^>]*)>\^/\^\1 <V-aN\3>\^/&&($j=296)||
	s/\^(E-aN-gN-c{E-aN-gN}) +<(VP)([^>]*)>\^/\^\1 <E-aN-gN\3>\^/&&($j=176)||
	s/\^(V-aN) +<VP +([^>]*)> +<ETC +([^>]*)>\^/\^\1 <\1 \2> <\1-c{\1} \3>\^/&&($j=149)||
	s/\^(V) +<IP +([^>]*)> +<ETC +([^>]*)>\^/\^\1 <\1 \2> <\1-c{\1} \3>\^/&&($j=557)||

	s/\^(V) +<IP +([^>]*)> +(<IP +[^>]*>)\^/\^\1 <\1 \2> <\1-c{\1} \3>\^/&&($j=343)||
	#PP-DIR as coordinated V-aN
	s/\^(V-aN|N) +<PP-DIR +([^>]*)> +<PP-DIR +([^>]*)>\^/\^\1 <\1 \2> <\1-c{\1} \[\1 \3]>\^/&&($j=vcor1)||
	s/\^(V-aN) +<(P|PP) +([^>]*)> +<QP +([^>]*)>\^/\^\1 <R-bV \3> <\1 \[Q \4]>\^/&&($j=490)||
	s/\^(N) +<(P|PP) +([^>]*)> +<NP +([^>]*)>\^/\^\1 <R-bV \3> <\1 \4>\^/&&($j=496)||
	s/\^(V-aN) +<PP +([^>]*)>\^/<\1 \2>/&&($j=491)||
	s/\^(V-c{V}) +<IP +([^>]*)>\^/\^\1 <V \2>\^/&&($j=344)||
	s/\^(V) +<CP +([^>]*)> +(<PU[^>]*>) +(<CP +[^>]*>)(.*)\^/\^\1 <\1 \2> <\1-c{\1} \3 \4\5>\^/&&($j=407)||
	s/\^(V|V-gN[^ ]*) +<(IP|CP) +([^>]*)> +(<PU[^>]*>) +(<IP +[^>]*>)(.*)\^/\^\1 <\1 \3> <\1-c{\1} \4 \5\6>\^/&&($j=413)||
	#delete empty subject
	s/\^(V) +<(NP-SBJ +\[-NONE- \*pro\*[^>]*)> +<VP +([^>]*)>\^/\^\1 <V-aN \3>\^/&&($j=149)||
	#V --> N V-aN
	s/\^(V-HLN|V) +<(NP[^ ]*-SBJ|LCP-SBJ|NP|DP-SBJ)[^ ]* ([^>]*)> +(<VP[^>]*>)(.*)\^/\^\1 <N \3> <V-aN \4\5>\^/&&($j=1)||
	s/\^(V) +<(NP[^ ]*-SBJ|LCP-SBJ|NP)[^ ]* ([^>]*)> +(<PU [^>]*>) +(<VP[^>]*>)\^/\^\1 <N \3> <V-aN \4 \5>\^/&&($j=437)||
	s/\^(V) +<(NP[^ ]*-SBJ|NP) +([^>]*)> +(<PP[^ ]*[^>]*>) +(<VP[^>]*>)\^/\^\1 <N \3> <V-aN \4 \5>\^/&&($j=472)||
	s/\^(V) +(<LCP-SBJ +[^>]*>) +(<PU[^>]*>) +(<VP[^>]*>)\^/\^\1 <N \2 \3> <V-aN \4>\^/&&($j=214)||
	s/\^(V) +(<QP-SBJ[^>]*>) (.*)\^/\^\1 <N \2> <V-aN \3>\^/&&($j=162)||
        s/\^(V|V-gN) +<(IP-SBJ)([^>]*)> (.*)\^/\^\1 <N [\2\3]> <V-aN \4>\^/&&($j=3)||
	#propogation of V-gN
	s/\^(V-gN) +(<NP[^ ]*-SBJ \[-NONE- \*T\*[^>]*>) +(.*)\^/\^\1 <V-aN \3>\^/&&($j=186)||
	s/\^(V-g{R-bV}) +<NP[^ ]*-SBJ +([^>]*)> +(.*)\^/\^\1 <N \2> <V-aN-g{R-bV} \3>\^/&&($j=260)||
	s/\^(V-aN-g{R-bV}) +<PP +\[-NONE-[^>]*> +<VP +([^>]*)>\^/\^\1 <V-aN \2>\^/&&($j=249)||

	#s/\^(V-gN) +<(NP[^ ]*-SBJ)([^>]*)> +(.*)\^/\^\1 <N\3> <V-aN-gN \4>\^/&&($j=61)||
        s/\^(V-aN-gN) +<(VP[^ ]*|VV|VSB|VRD|VCD|VE) +([^>]*)> +(<NP[^ ]*-OBJ \[-NONE- \*[^>]*>|<NP [^>]*-NONE- \*[^>]*>)\^/\^\1 <V-aN-bN \3>\^/&&($j=187)||
        s/\^(V-aN-gN) +(<VV +[^>]*>) +(<VV +[^>]*>) +(<NP[^ ]*-OBJ \[-NONE- \*[^>]*>)\^/\^\1 <V-aN-bN \2 \3>\^/&&($j=465)||
        s/\^(V-aN-gN) +(<VV +[^>]*>) +<IP[^ ]*-OBJ ([^>]*\[-NONE- \*[^>]*)>\^/\^\1 <V-aN-b{V-aN}-gN \2> <V-aN \3>\^/&&($j=547)||

        s/\^(V-aN-gN) +(<VV +[^>]*>) +(<NP[^ ]*-IO +[^>]*\*T\*[^>]*>) +<NP[^ ]*-OBJ +([^>]*)>\^/\^\1 <V-aN-bN-gN \2 \3> <N \4>\^/&&($j=337)||
	s/\^(V-aN-gN) +(<VV +[^>]*>|<VRD[^>]*>) +(<NP[^ ]*-IO +[^>]*>) +<NP[^ ]*-OBJ +[^>]*-NONE- \*T\*[^>]*>\^/\^\1 <V-aN-bN \2 \3>\^/&&($j=468)||
	s/\^(V-aN-bN-gN) +<VV +([^>]*)> +(<NP-IO +[^>]*\*T\*[^>]*>)\^/\^\1 <V-aN-bN-bN \2>\^/&&($j=33)||
	s/\^(V-aN) +(<VV +[^>]*>) +(<NP[^ ]*-IO +[^>]*>) +(<NP-OBJ +[^>]*>)\^/\^\1 <V-aN-bN \2 \3> <N \4>\^/&&($j=430)||
	s/\^(V-aN-bN) +<VRD +([^>]*)> +(<NP[^ ]*-OBJ +\[-NONE- \*RNR\*[^>]*>)\^/\^\1 <\1 \2>\^/&&($j=515)||
	s/\^(V-aN-bN) +(<VV +[^>]*>|<VRD[^>]*>) +(<NP[^ ]*-IO +[^>]*>)\^/\^\1 <V-aN-bN-bN \2> <N \3>\^/&&($j=431)||
	s/\^(V-aN-bN) +(<VV +[^>]*>) +(<AS +[^>]*>) +(<NP[^ ]* +[^>]*>)\^/\^\1 <V-aN-bN-bN \2 \3> <N \4>\^/&&($j=438)||
	s/\^(V-aN-bN-bN) +<VV +([^>]*)> +<VV +(给)>\^/\^\1 <V-aN-bN \2> <V-aN-bN-bN-a{V-aN-bN} \3>\^/&&($j=498)||
	#problematic?
	s/\^(V-gN) +(<QP-SBJ[^>]*>) +<VP([^>]*\*T\*[^>]*)>\^/\^\1 <N \2> <V-aN-gN\3>\^/&&($j=208)||
        s/\^(V-aN-g{A-bN}) +<(VP[^ ]*|VV|VE) +([^>]*)> +<NP-OBJ +([^>]*)> +<NP-EXT \[-NONE- \*T\*[^>]*>\^/\^\1 <V-aN-bN \3> <N-g{A-bN} \[N \4\]>\^/&&($j=209)||
	s/\^(N-gN) +<NP-OBJ +([^>]*)> +<NP-EXT \[-NONE- \*T\*[^>]*>\^/\^\1 <N \2>\^/&&($j=210)||

	#N-fNil<IP-SBJ ..> --> N-fNil<V-fN-fil ...>
	s/\^(N[^ ]* )<IP-SBJ +([^>]*)>\^/\^\1<V \2>\^/&&($j=2)||

	#IP as adverb IP-ADV --> R-bV(IP-ADV (N V-aN))
        #s/\^(V[^ ]*) +<(IP-ADV) +([^>]*)> (.*)\^/\^\1 <R-bV [V \3]> <\1 \4>\^/&&($j=4)||
	s/\^(V[^ ]*) +<(NP-ADV) +([^>]*)> (.*)\^/\^\1 <R-bV \3> <\1 \4>\^/&&($j=160)||
	#s/\^(V[^ ]*) +<(NP[^ ]*) +([^>]*)>(.*)(<NP-SBJ[^>]*>) +(<VP[^>]*>)\^/\^\1 <R-bV \[N \3]> <\1 \4\5 \6>\^/&&($j=450)||
	s/\^(V[^ ]*) +<(NP[^ ]*) +([^>]*)>(.*)(<NP-TPC[^>]*>) +(<IP[^>]*>)\^/\^\1 <R-bV \[N \3]> <\1 \4\5 \6>\^/&&($j=451)||
	
        #V --> adv pu
	s/\^(V) +(<NP-TMP +[^>]*>|<IP-TMP +[^>]*>|<PP[^>]*>|<QP-ADV[^>]*>) +(<PU[^>]*>) +(.*)\^/\^\1 <R-bV \2 \3> <\1 \4>\^/&&($j=174)||
	s/\^(V) +(<NP-TMP +[^>]*>|<QP-ADV[^>]*>) +(.*)\^/\^\1 <R-bV \2> <\1 \3>\^/&&($j=200)||
	s/\^(R-bV) +<NP-TMP +([^>]*)> +<PU +([^>]*)>\^/\^\1 <N \2> <PU \3>\^/&&($j=177)||
	s/\^(R-bV) +<(IP-TMP|IP-ADV) +([^>]*)> +<PU +([^>]*)>\^/\^\1 <V \3> <PU \4>\^/&&($j=476)||
	s/\^(R-bV) +<(IP-TMP|IP-ADV) +([^>]*)>\^/\^\1 <V \3>\^/&&($j=477)||
	s/\^(R-bV) +<NP-TMP +([^>]*)>\^/\^\1 <N \2>\^/&&($j=201)||
	s/\^(R-bV) +<MSP +([^>]*)> +<VP +([^>]*)>\^/\^\1 <R-bV-b{V-aN} \2> <V-aN \3>\^/&&($j=229)||
	s/\^(V-aN[^ ]*|E-aN[^ ]*) +<MSP +([^>]*)> +(<VP +[^>]*>)\^/\^\1 <R-bV \2> <\1 \3>\^/&&($j=306)||
	s/\^(V-aN[^ ]*) +<VA +([^>]*)> +(<ADVP +[^>]*>)\^/\^\1 <\1 \2> <R-bV \3>\^/&&($j=533)||
	s/\^(R-bV) +(<NP[^ ]*SBJ +[^>]*>) +(<VP +[^>]*>)\^/\^\1 <V \2 \3>\^/&&($j=554)||

	
	
	#IP as topic IP-TPC --> V (N(IP-TPC ()) V-gN)
	s/\^(V-gN) +<(IP-TPC) +([^>]*)> (.*\[-NONE- \*T\*.*)\^/\^\1 <N [V \3]> <V-gN-gN-fTPC \4>\^/&&($j=446)||
	#IP-TPC as R-bV
	s/\^(V[^ ]*) +<(IP-TPC) +([^>]*)> (.*)\^/\^\1 <R-bV [V \3]> <V \4>\^/&&($j=5)||

	#s/\^(V[^ ]*) +<(IP-TPC) +([^>]*)> (.*)\^/\^\1 <N [V \3]> <V-gN-fTPC \4>\^/&&($j=5)||
	s/\^(N[^ ]* )<IP-TPC +([^>]*)>\^/\^\1<V \2>\^/&&($j=18)||
	
	
	#NP-TPC
	s/\^(V-gN) +<NP-[^ ]*TPC +([^>]*-NONE- \*T\*[^>]*)> +(.*)<NP[^ ]*SBJ +([^>]*)> +<VP +([^>]*)>\^/<V-gN \3\[N-gN \4\] \[V-aN \5\]>/&&($j=303)||
	s/\^(V-gN-gN-fTPC) +(<NP-SBJ +[^>]*\[-NONE- \*T\*[^>]*>) +<VP +([^>]*)>\^/\^\1 <N-gN [N \2]> <V-aN \3>\^/&&($j=447)||
	s/\^(V-gN-fTPC) +(<QP-SBJ +[^>]*>|<NP[^ ]*SBJ +[^>]*>) +<VP +([^>]*)>\^/\^\1 <N-gN [N \2]> <V-aN \3>\^/&&($j=420)||
	s/\^(V-gN-fTPC) +<IP +([^>]*)> +(<IP +[^>]*>)(.*)\^/\^\1 <\1 \2> <\1-c{\1} \3\4>\^/&&($j=558)||
	s/\^(V-gN-fTPC-c{V-gN-fTPC}) +<IP +([^>]*)>\^/\^\1 <V-gN-fTPC \2>\^/&&($j=559)||

	s/\^(V-gN-fTPC) +<IP-SBJ +([^>]*)> +<VP +([^>]*)>\^/\^\1 <N-gN-fTPC [V-gN-fTPC \2]> <V-aN \3>\^/&&($j=459)||
	s/\^(V) +<NP-[^ ]*TPC +([^>]*)> +(.*)<NP-SBJ +([^>]*)> +<VP +([^>]*)>\^/\^\1 <N \2> <V-gN \3\[N-gN \4\] \[V-aN \5\]>\^/&&($j=182)||
	s/\^(V[^ ]*) +(<N +[^>]*>) +(<N-gN +[^>]*>) +(<V-aN +[^>]*>)\^/\^\1 <N \2> <V-gN \4 \5>\^/&&($j=183)||
	s/\^(V[^ ]*) +<NP-[^ ]*TPC +([^>]*)> +<IP +([^>]*)>\^/\^\1 <N \2> <V-gN-fTPC \3>\^/&&($j=206)||	
#	s/\^(V[^ ]*) +<NP-[^ ]*TPC +([^>]*)> +(<PP-SBJ +[^>]*>) +(<VP +[^>]*>)\^/<\1 [NP-SBJ \2] \3 \4>/&&($j=471)||
#	s/\^(V[^ ]*) +<NP-[^ ]*TPC +\[-NONE- \*PRO\*[^>]*> +(<PP[^ ]* +[^>]*>|<NP-LOC +[^>]*>|<ADVP[^ ]* +[^>]*>)(.*)\^/\^\1 <\1 \2\3>\^/&&($j=559)||	

	s/\^(V[^ ]*) +<NP-[^ ]*TPC +([^>]*)> +(<PP[^ ]* +[^>]*>|<NP-LOC +[^>]*>|<ADVP[^ ]* +[^>]*>)(.*)\^/\^\1 <N \2> <\1-gN-fTPC \3\4>\^/&&($j=457)||	
	s/\^(V[^ ]*) +<NP-[^ ]*TPC +([^>]*\[NT[^>]*)> +(<PU +[^>]*>) +(<IP +[^>]*>)\^/\^\1 <R-bV \[N \2\]> <\1 \3 \4>\^/&&($j=542)||	

	s/\^(V[^ ]*) +<NP-[^ ]*TPC +([^>]*)> +(<PU +[^>]*>) +(<IP +[^>]*>)\^/\^\1 <N \2> <V-gN-fTPC \3 \4>\^/&&($j=419)||	
	s/\^(V[^ ]*) +<NP-[^ ]*TPC-\d+ +([^>]*)> +(<NP-SBJ +[^>]*>) +(<VP +[^>]*\T\*[^>]*>)\^/\^\1 <N \2> <V-gN \3 \4>\^/&&($j=428)||	
	#relative clause: N-fNP(CP ... [DEC ..]])(NP..)(NP..)(NP..)-->N-fNP(A-rN...)(N...)
	#relativize A-bN
	s/\^(N[^ ]*) +<CP +(\[WHNP[^>]*\[NP-EXT \[-NONE- \*T\*[^>]*)(\[DEC[^>]*)> +(.*)(<NP[^>]*>)\^/\^\1 <D-g{A-bN} \2\3> <N \4\5>\^/&&($j=211)||
	s/\^(N[^ ]*) +<CP +(\[WHNP[^>]*\[PP[^ ]* \[-NONE- \*T\*[^>]*)> +(.*)(<NP[^>]*>)\^/\^\1 <D-g{R-bV} \2> <N \3\4>\^/&&($j=244)||

	s/\^(N[^ ]*) +<CP +(\[WHNP[^>]*\[NP-MNR[^ ]* \[-NONE- \*T\*[^>]*)> +(.*)(<NP[^>]*>)\^/\^\1 <D-g{R-bV} \2> <N \3\4>\^/&&($j=244)||
	s/\^(N[^ ]*) +<CP +(\[WHNP[^>]*\[NP-PRP[^ ]* \[-NONE- \*T\*[^>]*)> +(.*)(<NP[^>]*>)\^/\^\1 <D-g{R-bV} \2> <N \3\4>\^/&&($j=244)||

	s/\^(N[^ ]*) +<CP +(\[WHPP[^>]*\[PP[^ ]* \[-NONE- \*T\*[^>]*)> +(.*)(<NP[^>]*>)\^/\^\1 <D-g{R-bV} \2> <N \3\4>\^/&&($j=rel1)||

	s/\^(N[^ ]*) +<CP +(\[WHNP[^>]*\[NP-LOC[^ ]* \[-NONE- \*T\*[^>]*)> +(.*)(<NP[^>]*>)\^/\^\1 <D-g{R-bV} \2> <N \3\4>\^/&&($j=244)||
	s/\^(N[^ ]*) +<CP +(\[WHNP[^>]*\[NP-TPC[^ ]* \[-NONE- \*T\*[^>]*\[IP-SBJ[^>]*)> +(.*)(<NP[^>]*>)\^/\^\1 <D-g{R-bV} \2> <N \3\4>\^/&&($j=543)||

	s/\^(N[^ ]*) +<CP +(\[WHNP[^>]*\[NP-TMP[^ ]* \[-NONE- \*T\*[^>]*)> +(.*)(<NP[^>]*>)\^/\^\1 <D-g{R-bV} \2> <N \3\4>\^/&&($j=244)||
	#coordinated relative clause
	s/\^(N[^ ]*) +(<CP +\[WHNP[^>]*\[DEC[^>]*>) +(<CP +\[WHNP[^>]*\[DEC[^>]*>) +(.*)(<NP[^>]*>|<DP[^>]*>)\^/\^\1 <D-gN \2 \3> <N \4\5>\^/&&($j=560)||
	s/\^(D-gN) +<IP +([^>]*)> +<DEC +([^>]*)>\^/\^\1 <V-gN \2> <D-aV \3>\^/&&($j=578)||

	s/\^(D-gN) +<IP +([^>]*)> +(<CP +\[WHNP[^>]*\[DEC[^>]*>)\^/\^\1 <\1 \2\3> <\1-c{\1} \[\1 \4\]>\^/&&($j=561)||

	s/\^(N[^ ]*) +<CP +(\[WHNP[^>]*)(\[DEC[^>]*)> +(.*)(<NP[^>]*>|<DP[^>]*>)\^/\^\1 <D-gN \2\3> <N \4\5>\^/&&($j=16)||
	s/\^(N[^ ]*) +<CP +(\[WHPP[^>]*)(\[DEC[^>]*)> +(.*)(<NP[^>]*>)\^/\^\1 <D-g{R-bV} \2\3> <N \4\5>\^/&&($j=500)||
	s/\^(N[^ ]*) +<CP +(\[WHNP[^>]*\[NP-TMP[^ ]* \[-NONE- \*T\*[^>]*)(\[DEC[^>]*)>\^/\^\1 <D-g{R-bV} \2\3>\^/&&($j=244)||
	s/\^(N[^ ]*) +<CP +(\[WHNP[^>]*)(\[DEC[^>]*)>\^/\^\1 <D-gN \2\3>\^/&&($j=152)||
	s/\^(N[^ ]*) +<CP +(\[WHNP[^>]*\[NP-EXT \[-NONE- \*T\*[^>]*)> +(.*)(<NP[^>]*>)\^/\^\1 <D-g{A-bN} \2> <N \4\5>\^/&&($j=269)||
	s/\^(N[^ ]*) +<CP +(\[WHNP[^>]*\[NP-EXT \[-NONE- \*T\*[^>]*)>\^/\^\1 <N \2>\^/&&($j=270)||
	s/\^(N[^ ]*) +<WHNP[^>]*> +(<IP +[^>]*\[NP-EXT \[-NONE- \*T\*[^>]*>) +(.*)(<NP[^>]*>)\^/\^\1 <D-g{A-bN} \2> <N \3\4>\^/&&($j=271)||
	
	s/\^(N[^ ]*) +<CP +(\[WHNP[^>]*\*T[^>]*)> +(.*<NP.*)\^/\^\1 <D-gN \2> <N \3>\^/&&($j=82)||

	#s/\^(A-bN) +(<WHNP[^>]*>) +<CP +([^>]*) +(\[DEC[^>]*)>\^/\^\1 <V-gN \3> <A-bN-a{V-gN} \4>\^/&&($j=17)||
	s/\^(D-gN|D-g{A-bN}|D-g{R-bV}) +(<WHNP[^>]*>) +(<CP +[^>]*) +(\[DEC[^>]*>)\^/<\1 \3 \4>/&&($j=17)||
	s/\^(D-gN|D-g{A-bN}) +(<WHNP[^>]*>) +(<IP +[^>]*>)\^/<\1 \3>/&&($j=17)||
	s/\^(D-gN|D-g{A-bN}) +(<WHNP[^>]*>) +(<CP +[^>]*>) +(<DEC +[^>]*>)\^/<\1 \3 \4>/&&($j=240)||
	s/\^(D-gN) +(<WHNP[^>]*>) +<CP +([^>]*)>\^/<\1 \3>/&&($j=401)||
	s/\^(D-g{R-bV}) +(<WHNP[^>]*>) +(<IP +[^>]*>)\^/<\1 \3>/&&($j=245)||
	s/\^D-g({R-bV}|{A-bN}) +<IP +([^>]*)>\^/\^D-g\1 <V-g\1 \2>\^/&&($j=246)||
	#s/\^(N-a{D-g{R-bV}}|N-a{D-g{A-bN}}) +<NP +([^>]*)>\^/<\1 \2>/&&($j=rel1)||
	s/\^(N[^ ]*) +<QP +([^>]*)> +(<CP +\[WHNP[^>]*\[DEC[^>]*>) +(.*)(<NP +[^>]*>)(.*)\^/\^\1 <Q-bN \2> <N \3 \4\5\6>\^/&&($j=339)||
        #delete subject trace in relative clause
	s/\^(V-gN) +<NP[^ ]*([^>]*-NONE- \*T\*[^>]*)> +<VP +([^>]*)>\^/\^\1 <V-aN \3>\^/&&($j=19)||
	#passing down the trace to VP
        s/\^(V-gN) +<(NP[^ ]*SBJ|LCP-SBJ) +([^>]*)> +<VP +([^>]*-NONE- \*T\*[^>]*)>\^/\^\1 <N \3> <V-aN-gN \4>\^/&&($j=205)||
	s/\^(V-g{A-bN}) +<NP[^ ]*SBJ +([^>]*)> +<VP +([^>]*-NONE- \*T\*[^>]*)>\^/\^\1 <N \2> <V-aN-g{A-bN} \3>\^/&&($j=212)||
	s/\^(V-g{R-bV}) +<NP[^ ]*TPC +([^>]*)> +(<NP[^ ]*SBJ +[^>]*>) +(<VP +[^>]*-NONE- \*T\*[^>]*>)\^/\^\1 <N \2> <V-g{R-bV}-gN \3 \4>\^/&&($j=314)||
	s/\^(V-g{R-bV}) +<NP[^ ]*TPC +[^>]*-NONE- \*T\*[^>]*> +(<IP[^ ]*SBJ +[^>]*>) +(<VP +[^>]*>)\^/\^\1 <V \2 \3>\^/&&($j=544)||

	s/\^(V-g{R-bV}-gN) +<NP[^ ]*SBJ +([^>]*)> +<VP +([^>]*-NONE- \*T\*[^>]*)>\^/\^\1 <N-gN \2> <V-aN-g{R-bV} \3>\^/&&($j=315)||
	#annotate NP-PN before V as topic
	s/\^(V) +<NP-PN +([^>]*)> +(<NP-TMP +[^>]*>) +(<NP-SBJ [^>]*>) +(<VP +[^>]*>)\^/<\1 \[NP-TPC \2\] \3 \4 \5>/&&($j=tp1)||
	#annotate the first sbj as tpc if there are two
	s/\^(V) +<NP-SBJ +([^>]*)> +(<NP-SBJ [^>]*>) +(<VP +[^>]*>)\^/<\1 \[NP-TPC \2\] \3 \4>/&&($j=tp2)||

	#topicalization
	s/\^(V-gN) +<NP-SBJ([^>]*)> (.*)\^/\^\1 <N-gN\2> <V-aN \3>\^/&&($j=211)||
	s/\^(V-gN) +(<NP-[^ ]*TPC[^>]*>) +(<NP-SBJ[^>]*-NONE- \*T\*[^>]*>) (.*)\^/\^\1 <N-gN \2 \3> <V-aN \4>\^/&&($j=311)||
	s/\^(N-gN) +<NP-[^ ]*TPC([^>]*)> +<NP-SBJ[^>]*-NONE- \*T\*[^>]*>\^/\^\1 <N\2>\^/&&($j=312)||
	

	#for relative clause without DE
	s/\^(D-gN) +(<WHNP[^>]*>) +(<IP +[^>]*>)\^/\^\1 <V-gN \3>\^/&&($j=195)||
	#s/\^(D-gN) +(<WHPP[^>]*>) +(<CP +[^>]*) +(\[DEC[^>]*>)\^/\^\1 <D-g{R-bV} \3 \4>\^/&&($j=187)||
	s/\^(D-g{R-bV}) +(<WHPP[^>]*>) +(<CP +[^>]*) +(\[DEC[^>]*>)\^/\^\1 <D-g{R-bV} \3 \4>\^/&&($j=187)||
	s/\^(D-g{R-bV}) +(<WHPP[^>]*>) +<IP +([^>]*)>\^/\^\1 <V-g{R-bV} \3>\^/&&($j=rel2)||

	s/\^(D-gN|D-g{R-bV}|D-g{A-bN}) +<CP +([^>]*\[DEC[^>]*)>\^/<\1 \2>/&&($j=125)||
	s/\^(D-gN) +<CP +([^>]*)> +(<DEC +[^>]*>)\^/<\1 \2 \3>/&&($j=241)||
	s/\^(D-gN) +<CP +([^>]*)> +(<CP +[^>]*>)\^/\^\1 <\1 \2> <\1-c{\1} \[\1 \3\]>\^/&&($j=583)||

	s/\^(D-gN) +<CP +([^>]*)> +(<PU[^>]*>) +(<CP +[^>]*>)\^/\^\1 <\1 \2> <\1-c{\1} \3 \4>\^/&&($j=502)||
	s/\^(D-gN)-c{D-gN} +(<PU[^>]*>) +<CP +([^>]*)>\^/\^\1-c{\1} \2 <\1 \3>\^/&&($j=503)||
	s/\^(D-gN) +(<IP +[^>]*\*T[^>]*>) +<DEC +([^>]*)>\^/\^\1 <V-gN \2> <D-aV \3>\^/&&($j=83)||
	s/\^(D-gN) +<IP +([^>]*\*T[^>]*)>\^/\^\1 <V-gN \2>\^/&&($j=300)||
	s/\^(D-g{R-bV}) +(<IP +[^>]*\*T[^>]*>) +<(DEC|DEG) +([^>]*)>\^/\^\1 <V-g{R-bV} \2> <D-aV \4>\^/&&($j=83)||
	s/\^(D-g{A-bN}) +(<IP +[^>]*\*T[^>]*>) +<(DEC|DEG) +([^>]*)>\^/\^\1 <V-g{A-bN} \2> <D-aV \4>\^/&&($j=212)||
	s/\^(D-gN) +(<IP +[^>]*\*T[^>]*>) +<(DEC|DEG) +([^>]*)>\^/\^\1 <V-gN \2> <D-aV \4>\^/&&($j=rel3)||
	#take off IP
	s/\^(V-g[^ ]*) +<(IP) +([^>]*)>\^/<\1 \3>/&&($j=38)||
	s/\^(A-bN) +<(NP[^ ]*|DP[^ ]*|NN[^ ]*) +([^>]*)> +(<DEG[^>]*>)\^/\^\1 <N \3> <A-bN-aN \4>\^/&&($j=45)||
	s/\^(A-bN) +(<QP[^ ]* +[^>]*>) +(<DEG[^>]*>)\^/\^\1 <N \2> <A-bN-aN \3>\^/&&($j=236)||
	s/\^(A-bN) +<QP[^ ]* +([^>]*)> +<ADJP[^ ]* +([^>]*)>\^/\^\1 <A-bN-b{A-bN} \[Q \2\]> <\1 \3>\^/&&($j=517)||
	s/\^(A-bN) +<NP[^ ]* +([^>]*)> +<ADJP[^ ]* +([^>]*)>\^/\^\1 <A-bN \[N \2\]> <\1 \3>\^/&&($j=519)||
	s/\^(A-bN) +<(ADVP[^ ]*|DP[^ ]*) +([^>]*)> +(.*)\^/\^\1 <R-bV \3> <\1 \4>\^/&&($j=570)||
	s/\^(A-bN) +<NP[^ ]* +([^>]*)> +<DEC +([^>]*)>\^/\^\1 <N \2> <A-bN-aN \3>\^/&&($j=518)||
	s/\^(A-bN) +<NP[^ ]* +([^>]*)> +(.*)\^/\^\1 <R-bV \[N \2\]> <\1 \3>\^/&&($j=575)||

	s/\^(A-bN) +<ADJP[^ ]* +([^>]*)> +(<ADJP[^ ]* +[^>]*>)(.*)\^/\^\1 <A-bN \2> <\1-c{\1} \3\4>\^/&&($j=520)||
	s/\^(A-bN) +<ADJP[^ ]* +([^>]*)> +(<PU[^>]*>|<CC[^>]*>) +(<ADJP[^ ]* +[^>]*>)(.*)\^/\^\1 <A-bN \2> <\1-c{\1} \3 \4\5>\^/&&($j=522)||
	s/\^(A-bN-c{A-bN}) +(<ADJP[^ ]* +[^>]*>)(.*)\^/\^\1 <A-bN \2\3>\^/&&($j=521)||
	s/\^(A-bN-c{A-bN}) +(<PU +[^>]*>) +(<ADJP[^ ]* +[^>]*>)(.*)\^/\^\1 <\1-d{A-bN} \2> <A-bN \3\4>\^/&&($j=523)||
	s/\^(A-bN-c{A-bN}) +<CC +([^>]*)> +(<ADJP[^ ]* +[^>]*>)(.*)\^/\^\1 <\1-d{A-bN} \2> <A-bN \3\4>\^/&&($j=524)||

	#this should actually be relative clause (A-bN (ADJP (JJ 新)) (DEC 的)) (N 隐忧))
	s/\^(A-bN) +<ADJP[^ ]* +([^>]*)> +<DEC +([^>]*)>\^/\^\1 <A-bN \2> <A-bN-b{A-bN} \3>\^/&&($j=520)||
	s/\^(A-bN) +<ADVP[^ ]* +([^>]*)> +<NP +([^>]*)>\^/\^\1 <A-bN-bN \2> <N \3>\^/&&($j=521)||
	s/\^(A-bN) +<NP[^ ]* +([^>]*)> +<ADJP[^ ]* +([^>]*)>\^/\^\1 <A-bN-b{A-bN} \[N \2\]> <\1 \3>\^/&&($j=522)||
	s/\^(A-bN) +<QP[^ ]* +([^>]*)> +<ADJP[^ ]* +([^>]*)>\^/\^\1 <A-bN-b{A-bN} \[Q \2\]> <\1 \3>\^/&&($j=523)||
	s/\^(A-bN) +(<NP[^ ]* +[^>]*>) +(<NP[^ ]* +[^>]*>)\^/\^\1 <N \2 \3>\^/&&($j=524)||
	s/\^(A-bN) +<VP +([^>]*)>\^/\^\1 <V-aN \2>\^/&&($j=525)||

	s/\^(A-bN) +<(ADJP[^ ]*) +([^>]*)> +(<DEG[^>]*>)\^/\^\1 <A-bN \3> <A-bN-a{A-bN} \4>\^/&&($j=167)||
	s/\^(A-bN) +<(PP[^ ]*) +([^>]*)> +(<DEG[^>]*>)\^/\^\1 <R-bV \3> <A-bN-a{R-bV} \4>\^/&&($j=174)||
	s/\^(A-bN[^ ]* )<(NN[^ ]*|NP[^ ]*) +([^>]*)>\^/\^\1<N \3>\^/&&($j=77)||
	s/\^(A-bN) +(<LCP +[^>]*>) +(<DEG +[^>]*>)\^/\^\1 <N \2> <A-bN-aN \3>\^/&&($j=100)||
	s/\^(A-bN) +<(ADVP|AD) +([^>]*)> +<ADJP +([^>]*)>\^/\^\1 <R-bV \3> <A-bN \4>\^/&&($j=251)||
	#UCP
	s/\^(A-bN) +<UCP +([^>]*)> +<DEG +([^>]*)>\^/\^\1 <N \2> <A-bN-aN \3>\^/&&($j=224)||
	s/\^(R-bV) +<P +([^>]*)> +<UCP +([^>]*)>\^/\^\1 <\1-bN \2> <N-fUCP \3>\^/&&($j=462)||
	s/\^(N) +<NP +([^>]*)> +<UCP +([^>]*)>\^/\^\1 <A-bN \2> <N \3>\^/&&($j=225)||
	s/\^(N) +<UCP-APP +([^>]*)> +<NP +([^>]*)>\^/\^\1 <A-bN \[N \2\]> <N \3>\^/&&($j=499)||
	s/\^(V-aN) +<VC +([^>]*)> +<UCP-PRD +([^>]*)>\^/\^\1 <V-aN-bN \2> <N \3>\^/&&($j=321)||
	s/\^(V-aN) +<VC +([^>]*)> +<DNP-PRD +([^>]*)>\^/\^\1 <V-aN-b{A-bN} \2> <A-bN \3>\^/&&($j=421)||
	s/\^(V-aN) +<VV +([^>]*)> +<(UCP-OBJ|NP-PN) +([^>]*)>\^/\^\1 <V-aN-bN \2> <N \4>\^/&&($j=417)||
	s/\^(N-c{N}) +(<PU +[^>]*>) +(<IP +[^>]*>)(.*)\^/\^\1 \2 <N \3\4>\^/&&($j=322)||
	s/\^(N) +(<IP +[^>]*>) +(<PU [^>]*>) +(.*)\^/\^\1 <N \2> <N-c{N} \3 \4>\^/&&($j=323)||
	#FW
	s/\^(N) +<(NN) +([^>]*)> +<FW +([^>]*)>\^/\^\1 <A-bN \3> <N \4>\^/&&($j=272)||
	#appositive clause
	s/\^(N[^ ]*) +<(CP-APP|CP) +([^>]*\[DEC[^>]*)> +(.*)(<NP[^>]*>)\^/\^\1 <D \3> <N-aD \4\5>\^/&&($j=128)||
	s/\^(N[^ ]*) +<IP-APP +([^>]*)> +<NP[^ ]* +([^>]*)>\^/\^\1 <V \2> <N-aV \3>\^/&&($j=186)||
	s/\^(N[^ ]*) +<IP-APP +([^>]*)> +(.*)(<NP[^ ]* +[^>]*>)\^/\^\1 <V \2> <N-aV \3\4>\^/&&($j=249)||
	s/\^(D) +(.*) +<DEC +([^>]*)>\^/\^\1 <V \2> <D-aV \3>\^/&&($j=129)||
	s/\^(N-aD) +<NP +([^>]*)>\^/\^\1 <N \2>\^/&&($j=132)||
	s/\^(N-aD) +(<DNP +[^>]*>) +(.*)(<NP +[^>]*>)\^/\^\1 <N \2 \3\4>\^/&&($j=175)||
	#appositive without DEG
	s/\^(N[^ ]*) +<CP-APP +([^>]*)> +(.*)(<NP[^>]*>)\^/\^\1 <D \2> <N-aD \3\4>\^/&&($j=235)||
	s/\^(D) +<WH[^ ]*[^>]*-NONE-[^>]*> <IP +([^>]*)>\^/\^\1 <V \2>\^/&&($j=236)||
	s/\^(Q) +<(IP-APP) +([^>]*)> +<QP +([^>]*)>\^/\^\1 <D [V \3]> <Q-aD \4>\^/&&($j=574)||
	s/\^(Q-aD) +<OD +([^>]*)> +<CLP +([^>]*)>\^/\^\1 <C \2> <\1-aC \3>\^/&&($j=575)||
	s/\^(A-bN) +<(PRN|PN) +([^>]*)>\^/\^\1 <N \3>\^/&&($j=220)||
	s/\^(N) +(<PRN +[^>]*>) +<NP +([^>]*)>\^/\^\1 <A-bN \2> <N \3>\^/&&($j=331)||

	s/\^(Q[^ ]*) +<NP-APP +([^>]*)> +(<QP[^>]*>)\^/\^\1 <A-bN [N \2]> <\1 \3>\^/&&($j=247)||
	#quotation marks
	s/\^(V[^ ]*) +(<PU +[^>]*> +<IP +[^>]*>) +(<PU +[^>]*>)\^/\^\1 <\1 \2> \3\^/&&($j=130)||
	s/\^(V[^ ]*) +(<PU +[^>]*>) +(<IP +[^>]*>)\^/\^\1 \2 <\1 \3>\^/&&($j=131)||
	s/\^(E-aN[^ ]*) +(<PU +[^>]*> +<VV +[^>]*>) +(<PU +[^>]*>)\^/\^\1 <\1 \2> \3\^/&&($j=178)||
	s/\^(E-aN[^ ]*) +(<PU +[^>]*>) +(<VV +[^>]*>)\^/\^\1 \2 <\1 \3>\^/&&($j=179)||
	s/\^(N[^ ]*) +<(PU +[^>]*)> +<(NT|NN|NP|NP-PN|NR) +([^>]*)>(.*) +(<PU +[^>]*>)\^/\^\1 <\1 \[\2\] \[\3 \4\]\5> \6\^/&&($j=197)||
	s/\^(N[^ ]*) +(<PU +[^>]*>) +<(NT|NN|NP|NP-PN|NR) +([^>]*)>(.*)\^/\^\1 \2 <N \[\3 \4\]\5>\^/&&($j=198)||
	s/\^(N[^ ]*) +(<PU +[^>]*> +<QP +[^>]*>)(.*) +(<PU +[^>]*>)\^/\^\1 <\1 \2\3> \4\^/&&($j=197)||
	s/\^(N[^ ]*) +(<PU +[^>]*>) +(<QP +[^>]*>)(.*)\^/\^\1 \2 <N \3\4>\^/&&($j=210)||
	s/\^(N[^ ]*) +(<PU +[^>]*>) +(.*)(<NP +[^>]*>) +(<PU +[^>]*>)\^/\^\1 <\1 \2 \3\4> \5\^/&&($j=216)||
	s/\^(N[^ ]*) +(<PU +[^>]*>) +(<CC +[^>]*>) +(<NP +[^>]*>)\^/\^\1 \2 <\1 \3 \4>\^/&&($j=226)||
	s/\^(N[^ ]*) +(<PU +[^>]*>) +(.*)(<NP +[^>]*>)\^/\^\1 \2 <N \3\4>\^/&&($j=217)||
	s/\^(A-bN) +(<PU +[^>]*> +<NP +[^>]*>)(.*) +(<PU +[^>]*>)\^/\^\1 <N \2\3> \4\^/&&($j=223)||
	s/\^(A-bN) +(<PU +[^>]*> +<VP +[^>]*>)(.*) +(<PU +[^>]*>)\^/\^\1 <V-aN \2\3> \4\^/&&($j=224)||
	s/\^(A-bN) +(<PU +[^>]*> +<JJ +[^>]*>) +(<PU +[^>]*>)\^/\^\1 <\1 \2> \3\^/&&($j=258)||
	s/\^(A-bN) +(<PU +[^>]*>) +<JJ +([^>]*)>\^/\^\1 \2 <\1 \3>\^/&&($j=252)||
	s/\^(Q-bN) +(<PU +[^>]*>) +(<NP +[^>]*>|<ADJP +[^>]*>) +(<QP +[^>]*>) +(<PU +[^>]*>)\^/\^\1 <\1 \2 \3 \4> \5\^/&&($j=494)||
	s/\^(Q-bN) +(<PU +[^>]*>) +(<NP +[^>]*>|<ADJP +[^>]*>) +(<QP +[^>]*>)\^/\^\1 \2 <\1 \3 \4>\^/&&($j=495)||
	s/\^(B-aN[^ ]*) +(<PU +[^>]*> +<ADVP[^>]*> +<VP +[^>]*>) +(<PU +[^>]*>)\^/\^\1 <\1 \2> \3\^/&&($j=584)||
	s/\^(B-aN[^ ]*) +(<PU +[^>]*>) +(.*)(<VP +[^>]*>)\^/\^\1 \2 <\1 \3\4>\^/&&($j=585)||

	#parenthesis
	s/\^(N) +(<NP +[^>]*>|<NN +[^>]*>) +<PRN +([^>]*)>\^/\^\1 <N \2> <A-bN \3>\^/&&($j=218)||
	s/\^(N) +<PRN +([^>]*)> +(.*)(<NP +[^>]*>|<NN +[^>]*>)\^/\^\1 <A-bN \2> <N \3\4>\^/&&($j=416)||
	

	#(N (NP-..)(NP ..))--> (N (A-bN ...)(N...))
        s/\^(N[^ ]*) +(<NP[^ ]*[^>]*>|<PN[^>]*>|<NN[^>]*>) +(<CC [^>]*>) +(<NP[^ ]*[^>]*>|<PN[^>]*>|<NN[^>]*>) +(.*)(<NN[^>]*>|<NR[^>]*>)\^/\^\1 <A-bN [N \2 \3 \4]> <N \5\6>\^/&&($j=425)||
	s/\^(N[^ ]*) +<(NN|PN) +([^>]*)> +<PN +([^>]*)>\^/\^\1 <N \3> <A-bN \4>\^/&&($j=469)||
	
	#nominal coordination
	s/\^(N[^ ]*) +<N[^ ]*([^>]*)> +(<CC[^>]*>) +(.*)\^/\^\1 <N\2> <N-cN \3 \4>\^/&&($j=46)||
	s/\^(N[^ ]*) +(<N[^ ]*[^>]*> +<N[^C]*) +(<CC[^>]*>) +(.*)\^/\^\1 <N \2> <N-cN \3 \4>\^/&&($j=84)||
	s/\^(N[^ ]*) +(<NP +[^>]*>|<NN +[^>]*>|<NT +[^>]*>|<NR +[^>]*>) +(<PU[^>]*>)(.*)\^/\^\1 <\1 \2> <\1-c\{\1\} \3\4>\^/&&($j=75)||
	s/\^(N[^ ]*) +(<NP +[^>]*>|<NN +[^>]*>|<NT +[^>]*>) +(.*)(<PU ，>) +(<CC +[^>]*>)(.*)\^/\^\1 <\1 \2 \3\4> <\1-c\{\1\} \5\6>\^/&&($j=440)||
	s/\^(N[^ ]*) +(<NP +[^>]*>|<NN +[^>]*>|<NT +[^>]*>) +(.*) +(<PU ，>)\^/\^\1 <\1 \2 \3> \4\^/&&($j=441)||
	s/\^(N[^ ]*) +(<NP[^>]*>|<NN +[^>]*>|<NT +[^>]*>)(.*) +(<PU[^>]*>)\^/\^\1 <\1 \2\3> \4\^/&&($j=475)||

	s/\^(N[^ ]*) +(<NP[^ ]*[^>]*>|<PN[^>]*>|<NN[^>]*>) +(.*)(<NN[^>]*>|<NR[^>]*>)\^/\^\1 <A-bN \2> <N \3\4>\^/&&($j=6)||
	s/\^(N[^ ]*) +(<NP[^>]*>) +(<QP[^>]*>) +(<NN[^>]*>)\^/\^\1 <A-bN \2> <N \3 \4>\^/&&($j=346)||
	s/\^(N[^ ]*) +(<NN[^>]*>|<NP[^>]*>) +(<NN[^>]*>)\^/\^\1 <A-bN \2> <N \3>\^/&&($j=41)||
	s/\^(N[^ ]*) +(<NR[^>]*>|<NT[^>]*>) +(<NN[^>]*>)(.*)\^/\^\1 <A-bN \2> <N \3\4>\^/&&($j=99)||
	s/\^(N[^ ]*) +(<NP[^>]*>) +(<NP[^>]*>) +<PRN +([^>]*)>\^/\^\1 <N \2 \3> <A-bN [N \4]>\^/&&($j=197)||
	s/\^(N[^ ]*) +(<NT[^>]*>) +(<NT[^>]*>)(.*)\^/\^\1 <A-bN \2> <N \3\4>\^/&&($j=118)||
	s/\^(N[^ ]*) +(<NR[^>]*>) +(<NR[^>]*>) +(.*)\^/\^\1 <A-bN \2> <N \3 \4>\^/&&($j=116)||

	s/\^(N) +(<NP[^>]*>) +(<NP-EXT[^>]*>)\^/\^\1 <N \2> <A-bN \3>\^/&&($j=345)||
	s/\^(N) +(<NP[^>]*>) +(<NP[^>]*>)\^/\^\1 <A-bN \2> <N \3>\^/&&($j=50)||
	s/\^(N[^ ]*) +(<NP[^>]*>) +(<QP[^>]*> +<NP[^>]*>)\^/\^\1 <A-bN \[N \2\]> <N \3>\^/&&($j=80)||
	s/\^(N[^ ]*) +(<NP[^>]*>) +(<ADJP[^>]*> +<NP[^>]*>)\^/\^\1 <A-bN \2> <N \3>\^/&&($j=86)||
	s/\^(N[^ ]*) +(<NP[^>]*>|<NR[^>]*>|<NN[^>]*>)(.*) +(<ETC[^>]*>)\^/\^\1 <N \2\3> <N-cN \4>\^/&&($j=85)||
	s/\^(N[^ ]*) +<IP +([^>]*)> +(<ETC[^>]*>)\^/\^\1 <N \[V \2\]> <N-cN \3>\^/&&($j=446)||
	#UPC
	s/\^(N[^ ]*) +(<IP[^>]*>)(.*)(<NP[^>]*>) +(<ETC[^>]*>)\^/\^\1 <N \2\3\4> <N-cN \5>\^/&&($j=316)||
	s/\^(N[^ ]*) +(<IP +[^>]*>) +(<PU[^>]*>)(.*)(<NP[^>]*>)\^/\^\1 <N \2> <N-cN \3\4\5>\^/&&($j=317)||
	s/\^(N[^ ]*) +<IP +([^>]*)>\^/\^\1 <V \2>\^/&&($j=318)||
	s/\^(N[^ ]*) +(<IP +[^>]*>) +(<CC[^>]*>) +(<NP[^>]*>)\^/\^\1 <N \2> <N-cN \3 \4>\^/&&($j=319)||
	s/\^(V) +<UCP-SBJ +([^>]*)> +<VP +([^>]*)>\^/\^\1 <N \2> <V-aN \3>\^/&&($j=447)||
	s/\^(N[^ ]*) +(<QP +[^>]*>) +(<PU[^>]*>) +(<QP +[^>]*>)(.*)\^/\^\1 <Q \2 \3 \4\5>\^/&&($j=448)||
	s/\^(Q) +(<QP +[^>]*>) +(<PU[^>]*>) +(<QP +[^>]*>)(.*)\^/\^\1 <Q \2> <Q-cQ \3 \4\5>\^/&&($j=449)||
	s/\^(Q-cQ) +(<PU[^>]*>) +(<QP +[^>]*>)(.*)\^/\^\1 \2 <Q \3\4>\^/&&($j=450)||
	s/\^(Q) +<LCP +([^>]*)>\^/<\1 \2>/&&($j=451)||
	s/\^(Q) +<DNP +([^>]*)> +<LCP +([^>]*)>\^/\^\1 <A-bN \2> <Q \3>\^/&&($j=452)||
	s/\^(Q) +<QP +([^>]*)> +<LC +([^>]*)>\^/\^\1 <Q \2> <Q-bQ \3>\^/&&($j=453)||
	#localizer
	s/\^(N[^ ]*) +(<NP[^>]*>|<QP[^>]*>) +(<LC[^>]*>)\^/\^\1 <N \2> <N-aN \3>\^/&&($j=101)||
	s/\^(N[^ ]*) +<IP +([^>]*)> +<LC +([^>]*)>\^/\^\1 <V \2> <N-aV \3>\^/&&($j=190)||
	
        #QP
	s/\^(N[^ ]*) +<QP +(\[NP[^>]*)> +(<NP[^ ]*[^>]*>|<NN[^ ]*[^>]*>)\^/\^\1 <A-bN \[Q \2\]> <N \3>\^/&&($j=509)||
	s/\^(N[^ ]*) +(<QP[^ ]*[^>]*>) +(.*)(<NP[^ ]*[^>]*>|<NN[^ ]*[^>]*>)\^/\^\1 <Q \2 \3\4>\^/&&($j=64)||
	s/\^(N[^ ]*) +(<NN[^>]*>) +(<NN[^>]*>)([^CC]*)\^/\^\1 <A-bN \2> <N \3\4>\^/&&($j=65)||
	s/\^(N[^ ]*) +(<NN[^>]*>) +(<NN[^>]*>) +<ETC +([^>]*)>\^/\^\1 <N \2 \3> <N-cN \4>\^/&&($j=230)||
	s/\^(N[^ ]*) +<ADVP[^ ]*([^>]*)> +<DP[^ ]*([^>]*)>\^/\^\1 <R-bV\2> <N\3>\^/&&($j=54)||
	s/\^(N[^ ]*) +<DT[^ ]*([^>]*)> +<QP[^ ]*([^>]*)>\^/\^\1 <N-bQ\2> <Q\3>\^/&&($j=56)||
	s/\^(A-bN) +(<DT[^ ]*[^>]*>) +(<QP[^ ]*[^>]*>)\^/\^\1 <N-bN \2 \3>\^/&&($j=224)||
	#s/\^(N[^ ]*) +<NP[^ ]*([^>]*)> +<LC[^ ]*([^>]*)>\^/\^\1 <N\2> <N-aN\3>\^/&&($j=59)||
	s/\^(N[^ ]*) +<DP[^ ]*([^M|>]*)> +(.*)(<NP[^ ]*[^>]*>)\^/\^\1 <A-bN\2> <N \3\4>\^/&&($j=89)||
	s/\^(N[^ ]*) +<NP +([^>]*)> +<DP +([^>]*)>\^/\^\1 <A-bN \[N \2]> <N \3>\^/&&($j=418)||
	s/\^(N[^ ]*) +<DP[^ ]*(.*M[^>]*)> +(<CP [^>]*>) +(<NP[^ ]*[^>]*>)\^/\^\1 <N-gN\2> <N \3 \4>\^/&&($j=341)||
	s/\^(N[^ ]*) +<DP[^ ]*([^>]*M[^>]*)> +(.*)(<NP[^ ]*[^>]*>)\^/\^\1 <N-gN\2> <N \3\4>\^/&&($j=104)||
	s/\^(N) +(<DT[^ ]*[^>]*>) +(<CLP[^ ]*[^>]*>)\^/\^\1 <N-bQ \2> <Q \3>\^/&&($j=199)||
	s/\^(N-gN) +(<DT[^ ]*[^>]*>) +(<CLP[^ ]*[^>]*>)\^/\^\1 <N-bQ \2> <Q-gN \3>\^/&&($j=90)||
	s/ \^(N[^ ]*) +<Q[^ ]* \[-NONE- \*(PRO|pro|RNR)\*[^ ]*\^//&&($j=443)||
	s/ \^(N[^ ]*) +<Q[^ ]* \[-NONE- \*-\d+\]>\^//&&($j=445)||
	s/\^(N) +<QP[^ ]* +([^>]*)>\^/\^\1 <Q \2>\^/&&($j=159)||
	s/\^(N[^ ]*) +<DP +([^>]*)> +<LC +([^>]*)>\^/\^\1 <N \2> <N-bN \3>\^/&&($j=232)||
	s/\^(N) +<CD +([^>]*)>\^/\^\1 <C \2>\^/&&($j=250)||

	#s/\^(N-c{N}) +<(PU[^>]*)> +(<N[^ ]*[^>]*\[CC +[^>]*\] +\[NP[^>]*>)\^/\^\1 <\2> <\1 \3\4>\^/&&($j=226)||
	s/\^(N[^ ]*)-c([^ ]*) +<(PU[^>]*)> +(<NP[^ ]*[^>]*>|<NN[^ ]*[^>]*>|<NT[^ ]*[^>]*>|<NR[^ ]*[^>]*>)(.*)\^/\^\1-c\2 <\3> <\1 \4\5>\^/&&($j=76)||
	s/\^(N-c[^ ]*) +<CC[^ ]*([^>]*)> +(.*)\^/\^\1 <N-cN-dN \2> <N \3>\^/&&($j=47)||
	s/\^(N-c{N}) +(<PU +[^>]*>) +(<CC +[^>]*>) +(.*)\^/\^\1 \2 <\1 \3 \4>\^/&&($j=215)||
	#QP coordination
	s/\^(Q[^ ]*) +<QP[^ ]*([^>]*)> +(<CC[^>]*>) +(.*)\^/\^\1 <Q\2> <Q-cQ \3 \4>\^/&&($j=237)||
	s/\^(Q-c[^ ]*) +<CC[^ ]*([^>]*)> +(.*)\^/\^\1 <Q-cQ-dQ \2> <Q \3>\^/&&($j=238)||
	s/\^(Q) +<QP +([^>]*)> +<QP +([^>]*)>\^/\^\1 <Q-bN \2> <N \3>\^/&&($j=259)||
	#R-bV coordination
	s/\^(R-bV) +<(AD +[^>]*)> +(<PU[^>]*>) +(<AD +[^>]*>)\^/\^\1 <\1 [\2]> <\1-c\{\1\} \3 \4>\^/&&($j=192)||
	s/\^(R-bV)-c([^ ]*) +<(PU[^>]*)> +<AD +([^>]*)>\^/\^\1-c\2 <\3> <\1 \4>\^/&&($j=193)||
	s/\^(A-bN) +<(JJ +[^>]*)> +(<PU[^>]*>) +(<JJ +[^>]*>)\^/\^\1 <\1 [\2]> <\1-c\{\1\} \3 \4>\^/&&($j=256)||
	s/\^(A-bN)-c([^ ]*) +<(PU[^>]*)> +<JJ +([^>]*)>\^/\^\1-c\2 <\3> <\1 \4>\^/&&($j=254)||
	s/\^(A-bN) +<(JJ +[^>]*)> +(<JJ +[^>]*>)\^/\^\1 <\1 [\2]> <\1-c\{\1\} \3>\^/&&($j=288)||
	s/\^(A-bN-c{A-bN}) +(<JJ +[^>]*>)\^/\^\1 <A-bN \2>\^/&&($j=289)||

	s/\^(R-bV) +<(PP[^ ]*) ([^>]*)> +<(PP[^ ]*) ([^>]*)>\^/\^\1 <\1 \3> <\1-c{\1} [\1 \5]>\^/&&($j=283)||
	s/\^(R-bV) +<(VP-PRP) ([^>]*)> +(<PU [^>]*>) +(<VP-PRP [^>]*>)\^/\^\1 <\1 \3> <\1-c{\1} \4 \5>\^/&&($j=284)||
	#s/\^(R-bV-c{R-bV}) +(<PU [^>]*>) +<VP-PRP ([^>]*)>\^/\^\1 \2 <R-bV \3>\^/&&($j=287)||

	s/\^(R-bV) +<(ADVP) ([^>]*)> +(<VP +[^>]*>)\^/\^\1 <R-bV-bV \3> <V \4>\^/&&($j=285)||
	s/\^(R-bV) +<(ADVP) ([^>]*)> +<LCP +([^>]*)>\^/\^\1 <R-bV \3> <R-bV \4>\^/&&($j=586)||
	s/\^(R-bV) +(<DP +[^>]*>) +<LC +([^>]*)>\^/\^\1 <N \2> <R-bV-aN \3>\^/&&($j=605)||

	s/\^(R-bV) +(<DP +[^>]*>|<ADJP +[^>]*>) +(<NP +[^>]*>)\^/\^\1 <N \2 \3>\^/&&($j=368)||
	s/\^(R-bV) +<IP +([^>]*)> +<DEV +([^>]*)>\^/\^\1 <V \2> <\1-aV \3>\^/&&($j=605)||

	#elided subject
	s/\^(V) +<(VP) ([^>]*)>\^/\^\1 <V-aN \3>\^/&&($j=286)||

        #(N (ADJP ..) (...)) --> N (A-bN N)
	s/\^(N) +<UCP-APP +([^>]*)> +(<CP[^>]*>) +(<NP[^>]*>)\^/\^\1 <N \2> <N-cN \[N \3 \4\]>\^/&&($j=316)||
	s/\^(N[^ ]* )<(ADJP[^ ]*) +([^>]*)> (.*)\^/\^\1<A-bN \3> <N \4>\^/&&($j=36)||
	s/\^(N) +(<ADVP +[^>]*>) +(<ADJP +[^>]*>) +(<NP +[^>]*>|<NN +[^>]*>)\^/\^\1 <A-bN \2 \3> <\1 \4>\^/&&($j=604)||

	s/\^(N|N-gN) +<(PP|ADVP[^ ]*|LCP) +([^>]*)> +(.*)(<NP +[^>]*>|<NN +[^>]*>)\^/\^\1 <R-bV \3> <\1 \4\5>\^/&&($j=150)||
	s/\^(N) +<(PP|ADVP[^ ]*) +([^>]*)> +(<PP +[^>]*>) +(<NP +[^>]*>)\^/\^\1 <R-bV \3> <N \4 \5>\^/&&($j=227)||
	s/\^(N[^ ]*) +<(DNP[^ ]*) +([^>]*)> (.*)\^/\^\1 <A-bN \3> <\1 \4>\^/&&($j=44)||
	s/\^(Q[^ ]* )<(DNP[^ ]*) +([^>]*)> +<QP[^ ]* +([^>]*)>\^/\^\1<A-bN \3> <Q \4>\^/&&($j=165)||
	s/\^(Q[^ ]*) +<(DNP[^ ]*) +([^>]*)> +(<QP[^ ]* +[^>]*>) +(<ADVP[^ ]* +[^>]*>)\^/\^\1 <A-bN \3> <Q \4 \5>\^/&&($j=366)||
	s/\^(Q) +<(NP[^ ]*) +([^>]*)> +(.*)(<QP[^ ]* +[^>]*>)\^/\^\1 <A-bN [N \3]> <\1 \4\5>\^/&&($j=301)||
	s/\^(Q) +<(ADJP[^ ]*) +([^>]*)> +<QP[^ ]* +([^>]*)>\^/\^\1 <A-bN \3> <\1 \4>\^/&&($j=500)||
       	s/\^(N[^ ]* )<(NP[^ ]*) +([^>]*)> +<(QP-EXT[^ ]*) +([^>]*)>\^/\^\1<N \3> <A-bN [Q \5]>\^/&&($j=57)||
	#NP-APP 
	s/\^(N) +(<NP-APP[^>]*>) +(<PU[^>]*>) +<NP +([^>]*)>(.*)\^/\^\1 <\1 \2 \3> <A-bN \[N \4\5\]>\^/&&($j=492)||
	s/\^(A-bN) +<ADVP[^ ]* +\[AD (如)\]> +(<NP[^>]*>)(.*)\^/\^\1 <A-bN-bN \2> <N \3\4>\^/&&($j=493)||
	s/\^(N) +(<NP[^>]*>|<NR[^>]*>) +(<PU[^>]*>) +(<NP[^>]*>|<NR[^>]*>)(.*)\^/\^\1 <\1 \2> <N-cN \3 \4\5>\^/&&($j=255)||
	s/\^(N) +<NR +([^>]*)> +(<NR +[^>]*>)\^/\^\1 <N \2> <N-cN \3>\^/&&($j=576)||

	s/\^(N) +<NR-SHORT +([^>]*)> +(<NR[^>]*>)\^/\^\1 <\1 \2> <\1-cN \[N \3\]>\^/&&($j=596)||

	s/\^(N[^ ]* )(<NP[^>]*>|<NR[^>]*>) +(.*)(<NP[^>]*>|<NR[^>]*>|<PRN[^>]*>)\^/\^\1<A-bN \2> <N \3\4>\^/&&($j=124)||
	s/\^(A-bN) +<PU ([^>]*)> +<NP[^ ]* +([^>]*)>\^/\^\1 <A-bN-bN \2> <N \3>\^/&&($j=290)||
	s/\^(A-bN) +<CP ([^>]*)> +<DEG +([^>]*)>\^/\^\1 <D-gN \2> <\1-a{D-gN} \3>\^/&&($j=591)||
	s/\^(D-gN) +<PU ([^>]*)> +(.*)\^/\^\1 <PU \2> <\1 \3>\^/&&($j=592)||
	s/\^(D-gN) +<CP ([^>]*)> +(<CC +[^>]*>) +(<CP +[^>]*>)(.*)\^/\^\1 <\1 \2> <\1-c{\1} \3 \4\5>\^/&&($j=593)||
	s/\^(D-gN)-c{D-gN} +<CC +([^>]*)> +(<CP +[^>]*>)(.*)\^/\^\1 <\1-c{\1}-d{\1} \2> <\1 \3\4>\^/&&($j=594)||
	s/\^(D-gN) +<CP +([^>]*)> +<PU +([^>]*)>\^/\^\1 <\1 \2> <PU \3>\^/&&($j=595)||


        #V-aN(VP...)(PU...) --> V-aN(V-aN ...)(PU...)
	s/\^(V-aN[^ ]* )<(VP)([^>]*)> +<(PU[^>]*)>\^/\^\1<\1\3> <\4>\^/&&($j=9)||

	#collapse V-aN(VV...)(NP-OBJ...) --> V-aN(V-aN-bN ...)(N...)
	s/\^(V-aN) +<(VV|VE|VP|VRD|VSB|VCD|VC|VNV[^ ]*|VPT|NN) +([^>]*)> +(<NP-OBJ[^>]*>|<NP-PN-OBJ[^>]*>|<NP-EXT[^>]*>|<QP-OBJ[^>]*>|<LCP-OBJ[^>]*>|<NP-PN-PRD[^>]*>|<NP +[^>]*>|<NP-WH-PRD +[^>]*>|<NP[^ ]*OBJ[^>]*>|<DP[^ ]*OBJ[^>]*>)\^/\^\1 <V-aN-bN \3> <N \4>\^/&&($j=12)||
	s/\^(V-aN) +<(VV|VE|VP|VRD|VSB|VCD|VC|VNV[^ ]*|VPT|NN) +([^>]*)> +(<AS +[^>]*>) +(<NP-OBJ[^>]*>|<NP-PN-OBJ[^>]*>|<NP-EXT[^>]*>|<QP-OBJ[^>]*>|<LCP-OBJ[^>]*>|<NP-PN-PRD[^>]*>|<NP +[^>]*>|<NP-WH-PRD +[^>]*>|<NP[^ ]*OBJ[^>]*>|<DP[^ ]*OBJ[^>]*>)\^/\^\1 <V-aN-bN \[\2 \3\] \4> <N \5>\^/&&($j=556)||
	s/\^(V-aN[^ ]*) +<(VV|VE|VP|VRD|VSB|VCD|VC|VNV[^ ]*|VPT|NN) +([^>]*)> +<AS +([^>]*)>\^/\^\1 <\1 \3> <R-bV \4>\^/&&($j=557)||

	s/\^(V-aN[^ ]*) +(<VV +[^>]*>) +(<CD 一>) +\2\^/\^\1 <\1 \2> <\1-c{\1} \3 \2>\^/&&($j=477)||
	s/\^(V-aN[^ ]*)-c[^ ]* +<CD (一)> +<(VV) +([^>]*)>\^/\^\1 <\1-c{\1}-d{\1} \2> <\1 \4>\^/&&($j=478)||
	s/\^(V-aN) +<(VE|VP)([^>]*)> +(<NP-OBJ[^ ]* +[^>]*> +<QP-EXT[^ ]* +[^>]*>)\^/\^\1 <V-aN-bN\3> <N \4>\^/&&($j=213)||
	#s/\^(V-aN|V-aN-bN) +<(VSB|VV|VA|VRD) +([^>]*)> +<QP-EXT +([^>]*)>\^/\^\1 <\1 \3> <R-bV [Q \4]>\^/&&($j=466)||
	s/\^(V-aN|V-aN-bN) +(<VV[^>]*>|<VRD[^>]*>|<VSB[^>]*>|<VA[^>]*>)(.*) +<QP-EXT +([^>]*)>\^/\^\1 <\1 \2\3> <R-bV [Q \4]>\^/&&($j=474)||
	s/\^(V-aN) +<(VV|VE)([^>]*)> +(<NP-OBJ[^>]*>) +(<NP-EXT[^>]*>)\^/\^\1 <V-aN-bN\3> <N \4 \5>\^/&&($j=344)||
	s/\^(V-aN) +<NP-PRD +(\[QP[^>]*)>\^/\^\1 <Q \2>\^/&&($j=345)||
	s/\^(V-aN) +<P +([^>]*)> <NP[^ ]* +([^>]*)>\^/\^\1 <V-aN-bN \2> <N \3>\^/&&($j=517)||
	s/\^(V-aN) +(<NN[^ ]* +[^>]*>) (<NN[^ ]* +[^>]*>)\^/\^\1 <N \2 \3>\^/&&($j=545)||

	s/\^(V-aN) +<(VV|VE|VP|VC)([^>]*)> +(<NP-PRD[^>]*>|<QP-PRD[^>]*>)\^/\^\1 <V-aN-bN\3> <N \4>\^/&&($j=157)||
	s/\^(V-aN) +(<QP-PRD[^>]*>) +(<PU[^>]*>) +(<VP[^>]*>)\^/\^\1 <V-aN \[Q \2\]> <\1-c{\1} \3 \4>\^/&&($j=356)||
	s/\^(V-aN) +<(QP-PRD|QP-EXT) +([^>]*)>\^/\^\1 <Q \3>\^/&&($j=168)||
	s/\^(V-aN) +<P +([^>]*)> +<LCP +([^>]*)>\^/\^\1 <V-aN-bN \2> <N \3>\^/&&($j=304)||
	s/\^(V-aN[^ ]*) +(<QP-ADV +[^>]*>|<LCP-ADV +[^>]*>) +<VP +([^>]*)>\^/\^\1 <R-bV \2> <\1 \3>\^/&&($j=221)||
	s/\^(V-aN[^ ]*) +<(DVP) +([^>]*)> +(.*)\^/\^\1 <R-bV \3> <\1 \4>\^/&&($j=536)||
	s/\^(V-aN) +<(P) +([^>]*)> +<IP +([^>]*)>\^/\^\1 <V-aN-bV \3> <V \4>\^/&&($j=537)||
	s/\^(V-aN) +<(VA) +([^>]*)> +<AS +([^>]*)>\^/\^\1 <\1 \3> <R-bV \4>\^/&&($j=538)||
	s/\^(V-aN) +<(VA) +([^>]*)> +<IP-OBJ +(\[NP-SBJ \[-NONE- \*PRO[^>]*)>\^/\^\1 <V-aN-b{V-aN} \3> <V-aN \4>\^/&&($j=539)||

	s/\^(R-bV) +<QP-ADV +([^>]*)>\^/\^\1 <Q \2>\^/&&($j=222)||
	s/\^(R-bV) +<(LCP-ADV|PN) +([^>]*)>\^/<\1 \3>/&&($j=222)||
	#order subject control verb rule before 43
	s/\^(V-aN) +<(VV|VSB)([^>]*)> +<(IP[^ ]*) +(\[NP-SBJ +\[-NONE- \*PRO\*[^>]*)>\^/\^\1 <V-aN-b{V-aN}\3> <V-aN \5>\^/&&($j=147)||
	s/\^(V-aN-gN) +<(VV)([^>]*)> +<(IP[^ ]*) +(\[NP-SBJ +\[-NONE- \*PRO\*[^>]*-NONE- \*T\*-[^>]*)>\^/\^\1 <V-aN-b{V-aN}\3> <V-aN-gN \5>\^/&&($j=506)||
	s/\^(V-aN[^ ]*) +<(VC) +([^>]*)> +<VP[^ ]* +([^>]*)>\^/\^\1 <V-aN-b{V-aN} \3> <V-aN \4>\^/&&($j=189)||
	s/\^(V-aN|V-aN-gN) +<NP-SBJ +\[-NONE- \*PRO\*][^>]*> +(<VP[^>]*>)\^/<\1 \2>/&&($j=148)||
	s/\^(V-aN-gN) +<VV +([^>]*)> +<IP +([^>]*\*T\*[^>]*)>\^/\^\1 <V-aN-bV \2> <V-gN \3>\^/&&($j=429)||
	s/\^(V-aN) +<(VV|VE|VRD|VSB)([^>]*)> +<(IP[^ ]*)([^>]*)>\^/\^\1 <V-aN-bV\3> <V\5>\^/&&($j=43)||
	s/\^(V-aN) +(<VV [^>]*>) +(<PU[^>]*>) +(<PU[^>]*>) +(<IP-OBJ[^>]*>)\^/\^\1 <V-aN-bV \2 \3> <V \4 \5>\^/&&($j=497)||


	s/\^(V-aN-g{A-bN}) +<(VV|VNV)([^>]*)> +<(VP[^ ]*)([^>]*-NONE- \*T\*[^>]*)>\^/\^\1 <V-aN-b{V-aN}\3> <\1\5>\^/&&($j=441)||
	s/\^(V-aN-gN) +<(VV|VNV)[^ ]* ([^>]*)> +<VP +([^>]*[^>]*-NONE- \*T\*[^>]*)>\^/\^\1 <V-aN-b{V-aN} \3> <V-aN-gN \4>\^/&&($j=498)||
	s/\^(V-aN) +<(VV|VNV)[^ ]* ([^>]*)> +<(VP[^ ]*)([^>]*)>\^/\^\1 <V-aN-b{V-aN} \3> <V-aN\5>\^/&&($j=103)||
	s/\^(V-aN[^ ]*) +(<VV[^>]*> +[^<NP]*) +<(IP[^ ]*)([^>]*)>\^/\^\1 <V-aN-bV \2> <V\4>\^/&&($j=87)||
	s/\^(V-aN[^ ]*) +<(IP-ADV) +([^>]*)> +(.*)\^/\^\1 <R-bV [V \3]> <\1 \4>\^/&&($j=49)||
	s/\^(V[^ ]*)-g{R-bV} +<(NP-LOC|DP-TMP|NP-PN-LOC|NP-TMP) +\[-NONE- \*T\*[^>]*> (.*)\^/\^\1-g{R-bV} <\1 \3>\^/&&($j=440)||
	s/\^(V-aN[^ ]*|V-gN[^ ]*) +<(NP-TMP)([^>]*)> +(.*)\^/\^\1 <R-bV \[N\3\]> <\1 \4>\^/&&($j=117)||
	s/\^(V-aN[^ ]*) +<(DVP)([^>]*)> +<VP([^>]*)>\^/\^\1 <R-bV\3> <\1 \4>\^/&&($j=106)||
	s/\^(V-aN[^ ]*) +<(VCD)([^>]*)> ?\^/\^\1 <\1\3>\^/&&($j=107)||
	s/\^(V-aN[^ ]*) +<VV +([^>]*)> +<(VCD)([^>]*)>\^/\^\1 <V-aN-b{V-aN} \2> <V-aN \4>\^/&&($j=334)||
	s/\^(V-aN[^ ]*) +<(VA)([^>]*)> +(<VA[^>]*>.*)\^/\^\1 <\1\3> <V-aN-c{V-aN} \4>\^/&&($j=108)||
	s/\^(V-aN[^ ]*) +(<VV[^>]*>|<VCD[^>]*>) +(<AS[^>]*>) +(<NP-OBJ \[-NONE- \*T\*[^>]*>)\^/\^\1 <V-aN-bN \2 \3>\^/&&($j=188)||
	s/\^(V-aN) +(<VV[^>]*>|<VCD[^>]*>|<VE[^>]*>|<VRD[^>]*>) +(<AS[^>]*>) +(<NP[^ ]*-OBJ[^>]*>|<QP-OBJ[^>]*>)\^/\^\1 <V-aN-bN \2 \3> <N \4>\^/&&($j=73)||
	s/\^(V-aN-b{V-aN}) +(<VV[^>]*>|<VCD[^>]*>|<VE[^>]*>) +(<AS[^>]*>) +(<NP-OBJ[^>]*>)\^/\^\1 <V-aN-b{V-aN}-bN \2 \3> <N \4>\^/&&($j=354)||
	s/\^(V-aN[^ ]*) +(<VV[^>]*>|<VCD[^>]*>) +(<AS[^>]*>) +(<IP-OBJ[^>]*>)\^/\^\1 <V-aN-bV \2 \3> <V \4>\^/&&($j=196)||
	s/\^(V-aN[^ ]*) +(<VV[^>]*>|<VCD[^>]*>) +(<NP-IO[^>]*>) +(<PU[^>]*>) +(<IP-OBJ[^>]*>)\^/\^\1 <V-aN-bV \[V-aN-bV \2 \3\] \4> <V \5>\^/&&($j=402)||
	s/\^(V-aN[^ ]*) +(<VV[^>]*>|<VCD[^>]*>) +(<NP-IO[^>]*>) +(<IP-OBJ[^>]*>)\^/\^\1 <V-aN-bV \2 \3> <V \4>\^/&&($j=557)||

	s/\^(V-aN[^ ]*) +(<VV[^>]*>|<VCD[^>]*>) +(<NP-IO[^>]*>) +<PP +(\[P 以\] \[NP[^>]*)>\^/\^\1 <V-aN-bN \2 \3> <N \4>\^/&&($j=496)||
	s/\^(V-aN-bV) +<VV +([^>]*)> +<NP-IO +([^>]*)>\^/\^\1 <V-aN-bV-bN \2> <N \3>\^/&&($j=403)||
	s/\^(V-aN[^ ]*) +<VE +([^>]*)> +(<QP-OBJ[^>]*>)\^/\^\1 <V-aN-bN \2> <N \3>\^/&&($j=158)||
	s/\^(V-[^ ]*-gN) +<VV +([^>]*)> +(<QP-OBJ[^>]*-NONE- \*T\*-\d+\]>)\^/\^\1 <V-aN-bN \2>\^/&&($j=442)||
	s/\^(V-aN[^ ]*) +<VV +([^>]*)> +(<QP-OBJ[^>]*>)\^/\^\1 <V-aN-bN \2> <N \3>\^/&&($j=168)||
	s/\^(V-aN[^ ]*) +(<IP-CND +[^>]*>) +(<PU[^>]*>) +(.*)\^/\^\1 <R-bV \2 \3> <\1 \4>\^/&&($j=325)||
	s/\^(V) +<CP-CND +([^>]*)> +(<PU[^>]*>) +(.*)\^/\^\1 <R-bV \[V \2\] \3> <\1 \4>\^/&&($j=401)||
	s/\^(V) +<CP-CND +([^>]*)> +(.*)\^/\^\1 <R-bV \2> <\1 \3>\^/&&($j=534)||
	s/\^(R-bV) +<(IP-CND|CP-CND) +([^>]*)> +(<PU[^>]*>)\^/\^\1 <R-bV \3> \4\^/&&($j=326)||
	s/\^(R-bV) +<(IP-CND|CP-CND) +([^>]*)>\^/<\1 \3>/&&($j=553)||
#	s/\^(R-bV) +<NP-SBJ[^ ]* +([^>]*)> +<VP +([^>]*CS[^>]*)>\^/\^\1 <N \2> <R-bV-aN \3>\^/&&($j=327)||

	s/\^(R-bV) +<NP-SBJ[^ ]* +([^>]*)> +<VP +([^>]*CS[^>]*)>\^/\^\1 <N \2> <R-bV-aN \3>\^/&&($j=327)||
	s/\^(R-bV-aN) +<ADVP[^ ]* +([^>]*CS[^>]*)> +(.*)(<VP +[^>]*>)\^/\^\1 <R-bV-aN-b{V-aN} \2> <V-aN \3\4>\^/&&($j=328)||
	s/\^(R-bV) +<ADVP[^ ]* +([^>]*CS[^>]*)> +<CP +([^>]*\[SP 的话\])>\^/\^\1 <R-bV-b{R-bV} \2> <R-bV \3>\^/&&($j=412)||
	s/\^(R-bV) +<IP +([^>]*)> +<SP (的话)>\^/\^\1 <V \2> <R-bV-aV \3>\^/&&($j=413)||
	
        #norminalizer DE
	#?
	s/\^(V-aN) +(<VV[^>]*>) +(<PU [^>]*>) +<CP-OBJ +([^>]*SP[^>]*)>\^/<\1 \2 \4>/&&($j=367)||
	s/\^(V-aN) +<VV +([^>]*)> +<CP-OBJ +([^>]*)>\^/\^\1 <V-aN-bV \2> <V \3>\^/&&($j=374)||
	s/\^(V-aN) +<VC +([^>]*)> +<CP-PRD +([^>]*SP 的[^>]*)>\^/\^\1 <V-aN-bN \2> <N \3>\^/&&($j=536)||
	s/\^(V-aN) +(<VV +[^>]*>) +(<AS +[^>]*>) +<CP-OBJ +([^>]*)>\^/\^\1 <V-aN-bN \2 \3> <N \4>\^/&&($j=537)||
	s/\^(N) +<IP +([^>]*)> +<SP (了[^>]*)>\^/\^\1 <V \2> <R-bV \3>\^/&&($j=538)||
	s/\^(V-aN-bN) +<VV +([^>]*)> +(<VC +[^>]*>|<VE +[^>]*>)\^/\^\1 <\1 \2> <\1-a{\1} \3>\^/&&($j=540)||
	s/\^(V-aN) +<VCP +([^>]*)> +<NP-OBJ +([^>]*)>\^/\^\1 <V-aN-bN \2> <N \3>\^/&&($j=539)||
	s/\^(V-aN-bN) +(<VA +[^>]*>) +<VV +([^>]*)>\^/\^\1 <V-aN \2> <\1-a{V-aN} \3>\^/&&($j=589)||

	s/\^(V-aN) +<VV +([^>]*)> +<IP +([^>]*)> +(<SP [^>]*>)\^/\^\1 <V-aN-bV \2> <V \3 \4>\^/&&($j=368)||
	s/\^(V-aN) +<VP +([^>]*)> +(<SP [^>]*>)\^/<\1 \2 \3>/&&($j=369)||
	s/\^(V-aN) +<VC +([^>]*)> +<VP +([^>]*)> +(<SP +[^>]*>)\^/\^\1 <V-aN-bN \2> <N \3 \4>\^/&&($j=370)||
	#?
	#s/\^(N) +(.*) <SP ([^>]*)>\^/\^\1 <V-aN \2> <N-a{V-aN} \3>\^/&&($j=371)||
	
	s/\^(V[^ ]*) +<CP +([^>]*SP 的[^>]*)>\^/<V \2>/&&($j=375)||	
	s/\^(V) +<IP +([^>]*)> +(<SP 的>)\^/\^\1 <V \2 \3>\^/&&($j=376)||
	s/\^(V) +(<IP +[^>]*>) +(<SP [^>]*>) +(<PU[^>]*>) +<PP-PRP +([^>]*)>\^/\^\1 <V \2 \3 \4> <R-bV \5>\^/&&($j=408)||
	s/\^(V[^ ]*) +<CP +([^>]*SP 的[^>]*)>\^/<V \2>/&&($j=404)||	
	s/\^(V[^ ]*) +<IP +([^>]*)> +<SP (了)>\^/\^\1 <\1 \2> <R-bV \3>\^/&&($j=424)||
	s/\^(V[^ ]*) +<CP +([^>]*)>\^/<\1 \2>/&&($j=426)||
	s/\^(CP) +(<IP +[^>]*>) +(<SP [^>]*>) +(<PU[^>]*>)\^/\^V <V \2 \3> \4\^/&&($j=503)||
	#s/\^(V[^ ]*) +(<VV +[^>]*>)(.*) +<SP (了)>\^/\^\1 <\1 \2\3> <R-bV \4>\^/&&($j=425)||	


	#negation 
	s/\^(V-aN[^ ]*) +<(VV) +([^>]*)> +(<AD 不>) +(<VV [^>]*>)\^/\^\1 <\1 \3> <\1-b{\1} \4 \5>\^/&&($j=372)||
	s/\^(V-aN[^ ]*) +<AD +([^>]*)> +<(VV|VC) +([^>]*)>\^/\^\1 <R-bV \2> <\1 \4>\^/&&($j=373)||
	
	#A-not-A question: polar question
	s/\^(V-aN[^ ]*) +<(VV|VC) +([^>]*)> +(<AD 不>) +(<\2 +\3>)\^/\^\1 <\1 \3> <\1-c{\1} [\1 \4 \5]>\^/&&($j=436)||
	
	#adverbial DER:V-aN-b{V-aN}-a{V-aN} or V-aN-b{V-aN}-bN-a{V-aN} 
	s/\^(V-aN|B-aN-aN) +(<VV +[^>]*>|<VA +[^>]*>) +(<DER +[^>]*>) +<VP-EXT +([^>]*)>\^/\^\1 <\1-b{V-aN} \2 \3> <V-aN \4>\^/&&($j=374)||
#	s/\^(B-aN-aN) +(<VV +[^>]*>|<VA +[^>]*>) +(<DER +[^>]*>) +<VP-EXT +([^>]*)>\^/\^\1 <\1-b{V-aN} \2 \3> <V-aN \4>\^/&&($j=374)||

	s/\^(V-aN-b{V-aN}) +(<VV +[^>]*>) +<DER +([^>]*)>\^/\^\1 <V-aN-bN \2> <\1-a{V-aN-bN} \3>\^/&&($j=375)||
	s/\^(V-aN-b{V-aN}) +(<VA +[^>]*>) +<DER +([^>]*)>\^/\^\1 <V-aN \2> <\1-a{V-aN} \3>\^/&&($j=587)||

	s/\^(B-aN-aN-b{V-aN}) +(<VV +[^>]*>|<VA +[^>]*>) +<DER +([^>]*)>\^/\^\1 <V-aN-bN \2> <\1-a{V-aN-bN} \3>\^/&&($j=577)||
	s/\^(V-aN) +(<VV +[^>]*>|<VA +[^>]*>) +(<DER +[^>]*>) +<IP-EXT +([^>]*)>\^/<\1 \2 \3 \4>/&&($j=571)||
	s/\^(V-aN) +(<VV +[^>]*>|<VA +[^>]*>) +(<DER +[^>]*>) +(<NP-SBJ +[^>]*>) +(<VP +[^>]*>)\^/\^\1 <V-aN-b{V-aN} \2 \3 \4> <V-aN \5>\^/&&($j=571)||
	s/\^(V-aN-b{V-aN}) +(<VV +[^>]*>|<VA +[^>]*>) +(<DER +[^>]*>) +(<NP-SBJ +[^>]*>)\^/\^\1 <V-aN-b{V-aN}-bN \2 \3> <N \4>\^/&&($j=573)||

	s/\^(V-aN-b{V-aN}-bN) +(<VV +[^>]*>|<VA +[^>]*>) +<DER +([^>]*)>\^/\^\1 <V-aN-bN \2> <\1-a{V-aN-bN} \3>\^/&&($j=572)||

	#s/\^(V-aN-b{V-aN}-bR) +<(VV|VA) +([^>]*)>\^/\^\1 <V-aN \3>\^/&&($j=422)||
	
	#BA construction
	s/\^(V-aN[^ ]*) +<BA([^>]*)> +<IP-OBJ([^>]*)>\^/\^\1 <V-aN-b{B-aN}\2> <B-aN\3>\^/&&($j=109)||
	s/\^(B-aN[^ ]*) +<NP[^ ]*([^>]*)> +<VP([^>]*)>\^/\^\1 <N\2> <B-aN-aN\3>\^/&&($j=110)||
	s/\^(B-aN[^ ]*) +<IP-SBJ +([^>]*)> +<VP([^>]*)>\^/\^\1 <N [V \2]> <B-aN-aN\3>\^/&&($j=342)||
	s/\^(B-aN-aN) +(<VV +[^>]*>) +(<AS +[^>]*>) +(<NP[^ ]*[^>]*>)\^/\^\1 <V-aN-bN \2 \3 \4>\^/&&($j=437)||
	s/\^(B-aN-aN) +<VV +([^>]*)>\^/\^\1 <V-aN-bN \2>\^/&&($j=454)||
	s/\^(B-aN-aN) +(<VV +[^>]*>) +(<NP-IO[^>]*>) +<NP-OBJ +\[-NONE-[^>]*>\^/\^\1 <V-aN-bN \2 \3>\^/&&($j=597)||

	s/\^(B-aN-aN) +<VRD +([^>]*)>\^/<\1 \2>/&&($j=470)||
	s/\^(B-aN-aN) +<VV +([^>]*)> +<VV +([^>]*)>\^/\^\1 <V-aN-bN \2> <\1-a{V-aN-bN} \3>\^/&&($j=471)||
	s/\^(B-aN-aN) +<DVP +([^>]*)> +<VP +([^>]*)>\^/\^\1 <R-bV \2> <\1 \3>\^/&&($j=525)||
	s/\^(B-aN-aN|E-aN-gN) +<VP +([^>]*)> +<VP +([^>]*)>(.*)\^/\^\1 <\1 \2> <\1-a{\1} \[\1 \3\4\]>\^/&&($j=525)||
	s/\^(B-aN-aN-a{B-aN-aN}) +(<VP +[^>]*>)(.*)\^/\^\1 <B-aN-aN \2\3>\^/&&($j=526)||
	s/\^(E-aN-gN-a{E-aN-gN}) +(<VP +[^>]*>)(.*)\^/\^\1 <E-aN-gN \2\3>\^/&&($j=526)||
	s/\^(E-aN-gN-c{E-aN-gN}) +(<PU[^>]*>) +(<V[^ ]* +[^>]*>)(.*)\^/\^\1 \2 <E-aN-gN \3\4>\^/&&($j=582)||

	s/\^(B-aN-aN|E-aN-gN) +<VP +([^>]*)> +(<PU[^>]*>) +<VP +([^>]*)>(.*)\^/\^\1 <\1 \2> <\1-c{\1} \3 \4\5>\^/&&($j=527)||
	s/\^(B-aN-aN-a{B-aN-aN}) +(<PU[^>]*>) +(<VP +[^>]*>)(.*)\^/\^\1 <B-aN-aN-a{B-aN-aN}-b{B-aN-aN} \2> <B-aN-aN \3\4>\^/&&($j=528)||

	s/\^(E-aN-gN-a{E-aN-gN}) +(<PU[^>]*>) +(<VP +[^>]*>)(.*)\^/\^\1 <E-aN-gN-a{E-aN-gN}-b{E-aN-gN} \2> <E-aN-gN \3\4>\^/&&($j=528)||
	s/\^(B-aN-aN[^ ]*) +(<V[^ ]*[^>]*>) +<NP[^ ]*([^>]*)>\^/\^\1 <\1-bN \2> <N\3>\^/&&($j=111)||
	s/\^(B-aN-aN) +(<V[^ ]*[^>]*>) +<NP-OBJ +[^>]*-NONE-[^>]*> +<IP +([^>]*NP[^>]*\*PRO\*[^>]*)>\^/\^\1 <B-aN-aN-b{V-aN} \2> <V-aN \3>\^/&&($j=431)||
	s/\^(B-aN-aN) +(<V[^ ]*[^>]*>) +<IP-OBJ +([^>]*NP[^>]*\*PRO\*[^>]*)>\^/<\1 \2 \3>/&&($j=578)||
	s/\^(B-aN-aN) +(<V[^ ]* +[^>]*>) +(<NP-SBJ +[^>]*-NONE- \*PRO\*[^>]*>) +<VP +([^>]*)>\^/\^\1 <\1-b{V-aN} \2 \3> <V-aN \4>\^/&&($j=579)||

	#introduce gaps -v in ba
	s/\^(B-aN-aN) +(<V[^ ]*[^>]*>) +(<NP[^ ]*OBJ +[^>]*>) +(<IP +[^>]*NP-SBJ[^>]*\*PRO\*[^>]*>)\^/<B-aN-vN \[V-aN-vN \2 \3 \4\]>/&&($j=ba1)||
	s/\^(V-aN-vN) +(<V[^ ]*[^>]*>) +(<NP[^ ]*OBJ +[^>]*>) +(<IP +[^>]*NP-SBJ[^>]*\*PRO\*[^>]*>)\^/\^\1 <V-aN-b{V-aN} \2 \3> <V-aN-vN \4>\^/&&($j=ba2)||
	s/\^(V-aN-vN) +<IP +([^>]*NP-SBJ[^>]*\*PRO\*[^>]*)>\^/<\1 \2>/&&($j=ba3)||
	s/\^(V-aN-vN) +<NP-SBJ[^>]*\*PRO\*[^>]*> +<VP +([^>]*)>\^/\^\1 <V-aN-bN \2>\^/&&($j=ba4)||

	s/\^(B-aN-aN[^ ]*) +(<V[^ ]*[^>]*>) +<LCP-OBJ ([^>]*)>\^/\^\1 <B-aN-aN-bN \2> <N \3>\^/&&($j=181)||
	s/\^(B-aN-aN[^ ]*) +(<V[^ ]*[^>]*>) +(<PP ([^>]*)>)\^/\^\1 <V-aN-bN \2 \3>\^/&&($j=435)||
	s/\^(B-aN-aN[^ ]*) +(<V[^ ]*[^>]*>) +<QP-OBJ ([^>]*)>\^/\^\1 <B-aN-aN-bN \2> <N [Q \3]>\^/&&($j=347)||
	s/\^(B-aN-aN) +(<VV +[^>]*>) +<VP ([^>]*)>\^/\^\1 <B-aN-aN-b{V-aN} \2> <V-aN \3>\^/&&($j=348)||
	s/\^(B-aN-aN-b{V-aN}) +<VV +([^>]*)>\^/\^\1 <V-aN-b{V-aN}-aN \2>\^/&&($j=432)||
	s/\^(V-[^ ]*) +<(VV|VCD|VE|VRD) +([^>]*)> +<AS +([^>]*)>\^/\^\1 <\1 \3> <R-bV \4>\^/&&($j=74)||
	s/\^(E-[^ ]*|B-[^ ]*) +(<VV[^>]*>|<VCD[^>]*>|<VE[^>]*>|<VRD[^>]*>) +<AS +([^>]*)>\^/\^\1 <\1 \2> <R-bV \3>\^/&&($j=74)||
	s/\^(V-aN-bV[^ ]*) +<VV +([^>]*)> +<AS +([^>]*)>\^/\^\1 <\1 \2> <R-bV \3>\^/&&($j=88)||
	s/\^(B-aN-aN-bN) +<(VV|VCD) +([^>]*)> +<(VV|VA) +([^>]*)>\^/\^\1 <V-aN-bN \3> <\1-a{V-aN-bN} \5>\^/&&($j=134)||
	s/\^(B-aN-aN-bN) +<(VV) +([^>]*)> +<(VC) +([^>]*)>\^/\^\1 <\1 \3> <\1-a{\1} \5>\^/&&($j=524)||

	s/\^(V-aN-bN) +<VV +([^>]*)> +(<VV +为>)\^/\^\1 <V-aN \2> <V-aN-bN-a{V-aN} \3>\^/&&($j=370)||
	s/\^(V-aN-bN) +<VV +([^>]*)> +<VA +([^>]*)>\^/\^\1 <V-aN-bN \2> <V-aN-bN-a{V-aN-bN} \3>\^/&&($j=468)||
	s/\^(V-aN-bN) +<VA +([^>]*)> +(<VV +到>)\^/\^\1 <V-aN \2> <V-aN-bN-a{V-aN} \3>\^/&&($j=411)||
	s/\^(V-aN-bN) +<(VCD|VV) +([^>]*)> +<VV +(出|出来)>\^/\^\1 <\1 \3> <\1-a{\1} \4>\^/&&($j=455)||
	s/\^(V-aN-bN|V-aN-b{V-aN}-bN) +<VV +([^>]*)> +<VV +([^>]*)>\^/\^\1 <\1 \2> <\1-c{\1}\[\1 \3\]>\^/&&($j=319)||
	s/\^(V-aN-bN-c{V-aN-bN}) +<VV +([^>]*)>\^/\^\1 <V-aN-bN \2>\^/&&($j=320)||
	s/\^(V-aN-bN-a{V-aN-bN}) +<(VC|VE) +([^>]*)>\^/\^\1 <V-aN-bN \3>\^/&&($j=551)||

	#####BEI construction

#	s/\^(V-aN) +<SB +([^>]*)> +<VP +([^>]*)>\^/\^\1 <V-aN-b{E-gN} \2> <E-gN \3>\^/&&($j=153)||
#	s/\^(V-aN) +<LB +([^>]*)> +<IP-OBJ +([^>]*)>\^/\^\1 <V-aN-b{E-gN} \2> <E-gN \3>\^/&&($j=169)||
#	s/\^(E-gN) +(<VV +[^>]*>) +(<IP-OBJ +[^>]*>|<NP-OBJ +[^>]*>|<PP +[^>]*>|<DP-OBJ +[^>]*>)(.*)\^/\^\1 <E-aN-gN \2 \3\4>\^/&&($j=154)||
#	s/\^(E-gN) +(<VRD +[^>]*>)\^/\^\1 <E-aN-gN \2>\^/&&($j=422)||
#	s/\^(E-gN) +(<VRD +[^>]*>) +(<NP-OBJ \[-NONE-[^>]*>)\^/\^\1 <E-aN-gN \2 \3>\^/&&($j=454)||
#	s/\^(E-gN) +<NP[^ ]*SBJ +([^>]*)> +<VP +([^>]*)>\^/\^\1 <N \2> <E-aN-gN \3>\^/&&($j=170)||
#	s/\^(E-aN-gN) +<VV +([^>]*)> +<IP-OBJ +([^>]*)>\^/\^\1 <V-aN-gN \[V-aN-bV \2\] \[V-gN \3\]>\^/&&($j=155)||
#	s/\^(E-aN-gN) +(<VV +[^>]*>|<VRD +[^>]*>|<VSB +[^>]*>) +(<NP-OBJ +[^>]*-NONE- \*[^>]*>|<DP-OBJ +[^>]*-NONE- \*[^>]*>)\^/\^\1 <V-aN-gN \2 \3>\^/&&($j=477)||
#	s/\^(E-aN-gN) +(<VV +[^>]*>) +(<NP-OBJ +[^>]*-NONE- \*[^>]*>|<DP-OBJ +[^>]*-NONE- \*[^>]*>) +(<IP[^ ]* +[^>]*>)\^/\^\1 <V-aN-gN \2 \3 \4>\^/&&($j=501)||

#	s/\^(E-aN-gN) +(<VV +[^>]*>|<VRD +[^>]*>|<VSB +[^>]*>) +(<NP-OBJ +[^>]*>)\^/\^\1 <B-aN-aN \2 \3>\^/&&($j=164)||
#	s/\^(E-aN-gN) +(<VV +[^>]*>|<VRD +[^>]*>|<VSB +[^>]*>) +(<NP-OBJ +[^>]*-NONE- \*[^>]*>)\^/\^\1 <V-aN-gN \2 \3>\^/&&($j=429)||
#	s/\^(E-aN-gN) +(<VV +[^>]*>|<VRD +[^>]*>) +(<LCP-OBJ +[^>]*>)\^/\^\1 <B-aN-aN \2 \3>\^/&&($j=180)||
#	s/\^(E-aN-gN) +<(VV|VRD) +([^>]*)>\^/\^\1 <V-aN-gN \[V-aN-bN \3\]>\^/&&($j=422)||
#	s/\^(E-aN-gN) +(<VV +[^>]*>) +(<PP +[^>]*>)(.*)\^/\^\1 <V-aN-gN \[V-aN-bN \2 \3\4\]>\^/&&($j=421)||
#	s/\^(E-aN-gN) +(<VV +[^>]*>|<VRD +[^>]*>) +(<NP[^ ]* +\[-NONE-[^>]*>)(.*)\^/\^\1 <V-aN-gN \2 \3\4>\^/&&($j=409)||
	
	s/\^(V-aN) +(<SB +[^>]*>) +<VP +([^>]*)>\^/\^\1 <V-aN-b{E-aN-gN} \2> <E-aN-gN \3>\^/&&($j=b0)||
	s/\^(V-aN-b{E-aN-gN}) +<SB +([^>]*)>\^/\^\1 <V-aN-b{E-aN-gN}-bN \2>\^/&&($j=b13)||
	#breaking down the small clause in LB structure
	s/\^(V-aN) +(<LB +[^>]*>) +<(IP-OBJ|CP-OBJ) +([^>]*)>\^/<\1 \2 \4>/&&($j=b1)||
	s/\^(V-aN) +(<LB +[^>]*>) +(<NP-[^ ]*SBJ +[^>]*>) +<VP +([^>]*)>\^/\^\1 <V-aN-b{E-aN-gN} \2 \3> <E-aN-gN \4>\^/&&($j=b2)||
	s/\^(V-aN) +(<LB +[^>]*>) +(<WHNP-[^ ]* +[^>]*>) +<IP[^ ]* +([^>]*)>\^/<\1 \2 \4>/&&($j=b14)||
	s/\^(V-aN-b{E-aN-gN}) +<LB +([^>]*)> +<NP-[^ ]*SBJ +([^>]*)>\^/\^\1 <V-aN-b{E-aN-gN}-bN \2> <N \3>\^/&&($j=b3)||
	s/\^(E-aN-gN) +(<VRD +[^>]*>|<VV +[^>]*>|<VSB +[^>]*>)(.*) +(<NP[^ ]* +\[-NONE- \*[^>]*>)\^/\^\1 <E-aN-bN \2\3>\^/&&($j=534)||

	s/\^(E-aN-gN) +(<VV +[^>]*>) +(<NP[^ ]*-IO +\[-NONE- \*[^>]*>) +<NP[^ ]*-OBJ +([^>]*)>\^/\^\1 <E-aN-bN-gN \2 \3> <N \4>\^/&&($j=551)||
	s/\^(E-aN-bN-gN) +(<VV +[^>]*>) +(<NP[^ ]*-IO +\[-NONE- \*[^>]*>)\^/\^\1 <E-aN-bN-bN \2>\^/&&($j=552)||
	s/\^(E-aN-gN) +(<VV +[^>]*>) +<PP[^ ]* +([^>]*)>\^/\^\1 <\1 \2> <R-bV \3>\^/&&($j=554)||

	s/\^(E-aN-bN-bN) +<VV +([^>]*)>\^/\^\1 <V-aN-bN-bN \2>\^/&&($j=553)||

	s/\^(E-aN-gN) +(<VRD +[^>]*>|<VV +[^>]*>|<VSB +[^>]*>|<VCP +[^>]*>) +(<NP-OBJ +[^>]*>|<NP[^ ]* +[^>]*>)\^/\^\1 <E-aN-aN \2 \3>\^/&&($j=b4)||
	s/\^(E-aN-gN) +(<VRD +[^>]*>|<VV +[^>]*>|<VSB +[^>]*>) +(<AS[^>]*>) +(<NP[^ ]*OBJ +[^>]*>)\^/\^\1 <E-aN-aN \2 \3 \4>\^/&&($j=527)||

	s/\^(E-aN-aN) +(<VRD +[^>]*>|<VV +[^>]*>|<VSB +[^>]*>|<VCP +[^>]*>) +<(NP[^ ]*|LCP-OBJ) +([^>]*)>\^/\^\1 <E-aN-aN-bN \2> <N \4>\^/&&($j=b5)||

	s/\^(E-aN-gN) +(<VV +[^>]*>) +(<NP[^ ]*OBJ +[^>]*-NONE-[^>]*>) +<IP[^ ]* +([^>]*)>\^/\^\1 <E-aN-b{V-aN}-gN \2 \3> <V-aN \4>\^/&&($j=528)||
	s/\^(E-aN-b{V-aN}-gN) +(<VV +[^>]*>) +(<NP[^ ]*OBJ +[^>]*-NONE-[^>]*>)\^/\^\1 <E-aN-b{V-aN}-bN \2>\^/&&($j=529)||
	s/\^(E-aN-aN) +(<VRD +[^>]*>|<VV +[^>]*>|<VSB +[^>]*>) +(<AS[^>]*>) +<(NP[^ ]*OBJ|LCP-OBJ) +([^>]*)>\^/\^\1 <E-aN-aN-bN \2 \3> <N \5>\^/&&($j=528)||

	s/\^(E-aN-aN-bN) +<(VRD|VV|VSB|VCP) +([^>]*)>\^/\^\1 <B-aN-aN-bN \3>\^/&&($j=b6)||
	s/\^(E-aN-b{V-aN}-bN) +<(VRD|VV|VSB) +([^>]*)>\^/\^\1 <V-aN-b{V-aN}-bN \3>\^/&&($j=529)||
	s/\^(E-aN-gN) +(<VRD +[^>]*>|<VV +[^>]*>|<VSB +[^>]*>|<VCD +[^>]*>) +(<NP-OBJ +[^>]*-NONE- \*T\*[^>]*>)\^/\^\1 <E-aN-bN \2>\^/&&($j=b15)||
	s/\^(E-aN-gN) +(<VRD[^>]*>|<VV[^>]*>|<VSB[^>]*>|<VCD[^>]*>)\^/\^\1 <E-aN-bN \2>\^/&&($j=550)||
	s/\^(E-aN-bN) +<(VRD|VV|VSB|VCD) +([^>]*)>\^/\^\1 <V-aN-bN \3>\^/&&($j=551)||

	#breaking down the small clause of object control verb
	#weird, object controls annotated differently in LB and SB
	s/\^(E-aN-gN) +(<VV +[^>]*>) +<IP-OBJ (\[NP-OBJ \[-NONE- \*pro\*+[^>]*|\[NP-SBJ \[-NONE- \*[^>]*)>\^/<\1 \2 \3>/&&($j=b7)||
	s/\^(E-aN-gN) +<VP +([^>]*)>\^/<\1 \2>/&&($j=b13)||
	s/\^(E-aN-gN) +(<VV +[^>]*>) +(<NP-OBJ \[-NONE- \*pro\*+[^>]*>|<NP-SBJ \[-NONE- \*[^>]*>) +<VP +([^>]*)>\^/\^\1 <E-aN-b{V-aN}-gN \2 \3> <V-aN \4>\^/&&($j=b8)||
	s/\^(E-aN-b{V-aN}-gN) +(<VV +[^>]*>) +(<NP-OBJ \[-NONE- \*pro\*+[^>]*>|<NP-SBJ \[-NONE- \*[^>]*>)\^/\^\1 <E-aN-b{V-aN}-bN \2>\^/&&($j=b9)||
	s/\^(E-aN-b{V-aN}-bN) +<VV +([^>]*)>\^/\^\1 <V-aN-b{V-aN}-bN \2>\^/&&($j=b10)||
	s/\^(E-aN-gN) +(<VV +[^>]*>)\^/\^\1 <E-aN-bN \2>\^/&&($j=b11)||
	s/\^(E-aN-bN) +(<VV +[^>]*>|<VCD [^>]*>)\^/\^\1 <V-aN-bN \2>\^/&&($j=b12)||
	s/\^(E-aN-gN) +(<VV +[^>]*>) +(<DER [^>]*>) +<VP[^ ]* +([^>]*)>\^/\^\1 <E-aN-b{V-aN}-gN \2 \3> <V-aN \4>\^/&&($j=579)||
	s/\^(E-aN-b{V-aN}-gN) +(<VV +[^>]*>) +(<DER [^>]*>)\^/\^\1 <E-aN-b{V-aN}-bN \2 \3>\^/&&($j=580)||
	s/\^(E-aN-b{V-aN}-bN) +(<VV +[^>]*>) +(<DER [^>]*>)\^/\^\1 <V-aN-b{V-aN}-bN \2 \3>\^/&&($j=581)||

#	s/\^(E-aN-gN) +(<VV +[^>]*>|<VCD [^>]*>) +(<AS +[^>]*>) +(<NP[^ ]*OBJ +[^>]*>)\^/\^\1 <\1 \2 \3>\^/&&($j=526)||
       
	#for an annotation mistake? 
	#s/\^(V-gN) +<NP[^ ]* +([^>]*)> +<VP +([^>]*)>\^/\^\1 <N \2> <V-aN \3>\^/&&($j=mis)||
	
	#object control verb
	#s/\^(V-aN) +(<VV[^>]*>|<VSB[^>]*>|<VRD[^>]*>|<VE[^>]*>) +(<NP[^ ]*-OBJ[^>]*>) +<IP +(\[NP-TPC[^>]*\*PRO\*[^>]*)>\^/\^\1 <V-aN-b{V-gN} \2 \3> <V-gN-fTPC \4>\^/&&($j=590)||

	s/\^(V-aN) +(<VV[^>]*>|<VSB[^>]*>|<VRD[^>]*>|<VE[^>]*>) +(<NP[^ ]*-OBJ[^>]*>) +(<IP[^>]*\*PRO\*[^>]*>)\^/\^\1 <V-aN-b{V-aN} \2 \3> <V-aN \4>\^/&&($j=119)||
	s/\^(V-aN-gN) +(<VV[^>]*>|<VSB[^>]*>) +(<NP[^ ]*-OBJ[^>]*-NONE- \*-\d[^>]*>|<DP[^ ]*-OBJ[^>]*-NONE- \*-\d[^>]*>) +(<IP[^>]*\*PRO\*[^>]*>)\^/\^\1 <V-aN-b{V-aN}-gN \2 \3> <V-aN \4>\^/&&($j=502)||
	s/\^(V-aN-b{V-aN}-gN) +<VV +([^>]*)> +(<NP[^ ]*-OBJ[^>]*-NONE- \*-\d[^>]*>|<DP[^ ]*-OBJ[^>]*-NONE- \*-\d[^>]*>)\^/\^\1 <V-aN-b{V-aN}-bN \2>\^/&&($j=440)||
	s/\^(V-aN[^ ]*) +(<VV[^>]*>) +(<AS[^>]*>) +(<NP[^ ]*-OBJ[^>]*>) +(<IP[^>]*\*PRO\*[^>]*>)\^/\^\1 <V-aN-b{V-aN} \2 \3 \4> <V-aN \5>\^/&&($j=353)||
	s/\^(V-aN[^ ]*) +(<VV[^>]*>) +(<AS[^>]*>) +(<NP[^ ]*-OBJ[^>]*>) +(<PU [^>]*>) +(<IP[^>]*\*PRO\*[^>]*>)\^/\^\1 <V-aN-b{V-aN} \2 \3 \4 \5> <V-aN \6>\^/&&($j=426)||
	s/\^(V-aN[^ ]*) +(<VV[^>]*>) +(<NP[^ ]*-OBJ[^>]*>) +(<PU [^>]*>) +(<IP[^>]*\*PRO\*[^>]*>)\^/\^\1 <V-aN-b{V-aN} \2 \3 \4> <V-aN \5>\^/&&($j=427)||

	s/\^(V-aN[^ ]*) +(<VP[^>]*>) +(<NP[^>]*>) +<IP[^ ]*([^>]*\*PRO\*[^>]*)>\^/\^\1 <V-aN-b{V-aN} \2 \3> <V-aN \4>\^/&&($j=142)||
	s/\^(V-aN-b{V-aN}) +<(VV|VSB|VRD|VE)([^>]*)> +<NP[^ ]*-OBJ[^ ]* ([^>]*)>\^/\^\1 <V-aN-b{V-aN}-bN\3> <N \4>\^/&&($j=120)||
	s/\^(V-aN-b{V-aN}) +<VP([^>]*)> +<NP([^>]*)>\^/\^\1 <V-aN-b{V-aN}-bN\2> <N\3>\^/&&($j=143)||
	s/\^(V-aN) +<NP +\[-NONE- \*PRO[^>]*> +(<VP +[^>]*>)\^/<\1 \2>/&&($j=554)||
	#DER
	s/\^(V-aN) +<VPT +([^>]*)> +<IP-OBJ +([^>]*)>\^/\^\1 <V-aN-b{V-aN} \2> <V-aN \3>\^/&&($j=555)||
	s/\^(V-aN[^ ]*) +<VV +([^>]*)> +(<DER +[^>]*>) +(<VV +[^>]*>)\^/\^\1 <\1 \2> <R-bV \3 \4>\^/&&($j=556)||
	s/\^(R-bV) +<DER +([^>]*)> +<VV +([^>]*)>\^/\^\1 <\1-b{V-aN} \2> <V-aN \3>\^/&&($j=556)||
	

        #focus structure
	s/\^(V-aN[^ ]*) +<NP-FOC +([^>]*)> +<VP +([^>]*)>\^/\^\1 <N \2> <\1-gN [\1-bN \3]>\^/&&($j=467)||
	s/\^(V-aN[^ ]*) +<VP-FOC +([^>]*)> +<VP +([^>]*)>\^/\^\1 <R-bV [V-aN \2]> <V-aN \3>\^/&&($j=280)||
	s/\^(V-aN[^ ]*) +<VP-FOC +([^>]*)>\^/<\1 \2>/&&($j=423)||
	s/\^(V-aN-g{V-aN}) +([^>]*)\^/\^\1 <V-aN-b{V-aN} \2>\^/&&($j=281)||
        #collaps : in list
	s/\^(V-aN) +(<VC[^>]*>) +(<PU[^>]*>) +(<IP-PRD[^>]*>)\^/\^\1 <V-aN-bV \2 \3> <V \4>\^/&&($j=125)||
	s/\^(V-aN) +<VC +([^>]*)> +<IP-PRD +([^>]*)>\^/\^\1 <V-aN-bV \2> <V \3>\^/&&($j=308)||
	s/\^(V-aN) +<VC +([^>]*)> +<UCP-PRD +([^>]*)>\^/\^\1 <V-aN-bN \2> <N \3>\^/&&($j=321)||
	s/\^(V-aN) +<VC +([^>]*)> +<PP[^ ]* +([^>]*)>\^/\^\1 <V-aN-b{R-bV} \2> <R-bV \3>\^/&&($j=415)||
	s/\^(V-aN-bV) +<VC([^>]*)> +(<PU[^>]*>)\^/\^\1 <V-aN-bV\2> \3\^/&&($j=126)||

	#collapse the IP in object-control verb into a VP
	s/\^(V-aN) +<NP[^ ]*-SBJ([^>]*\*PRO\*[^>]*)> +<VP([^>]*)>\^/<\1 \3>/&&($j=123)||

	#V-aN <VA ...> <QP-EXT...> --> V-aN <V-aN...> <R-bV ...>
	s/\^(V-aN[^ ]*) +(<VA[^>]*>|<VV[^>]*>|<VRD[^>]*>)(.*) +<(LCP-EXT[^>]*)>\^/\^\1 <\1 \2\3> <R-bV [\4]>\^/&&($j=30)||
	s/\^(V-aN) +<VA +([^>]*)> +<VV +([^>]*)>\^/\^\1 <\1 \2> <\1-b{\1} \3>\^/&&($j=420)||
	s/\^(V-aN[^ ]*) +<(VV)([^>]*)> +(<NP-OBJ +[^>]*>) +(<QP-EXT[^>]*>)\^/\^\1 <V-aN-bN\3> <N \4 \5>\^/&&($j=193)||
	s/\^(V-aN) +<(VV)([^>]*)> +(<NP-OBJ +[^>]*>) +(<QP-EXT[^>]*>)\^/\^\1 <V-aN-bN\3> <N \4 \5>\^/&&($j=193)||

	s/\^(V-aN) +(<VV +[^>]*>) +(<AS +[^>]*>) +(<NP-OBJ +[^>]*>) +(<QP-EXT[^>]*>)\^/\^\1 <V-aN-bN \2 \3> <N \4 \5>\^/&&($j=475)||
	s/\^(V-aN) +<(VP|VV) +([^>]*)> +(<VP-PRP +[^>]*>|<PP[^ ]* +[^>]*>)\^/\^\1 <\1 \3> <R-bV \4>\^/&&($j=226)||
	s/\^(R-bV) +<VP-PRP +([^>]*)>\^/\^\1 <V-aN \2>\^/&&($j=227)||
	#correct VP-PRP annotation
	#s/\^(R-bV) +<VP-PRP +([^>]*AD[^>]*)> +(<PU +[^>]*>) +<VP-PRP +([^>]*)>\^/<\1 \2 \3 [VP \4]>/&&($j=271)||
	#s/\^(R-bV) +<ADVP[^ ]* +([^>]*)> +(<VP +[^>]*>)(.*)\^/\^\1 <R-bV-bV \2> <V \3\4>\^/&&($j=272)||

	#R-bV<QP-EXT [CD ...][CLP ..]> --> R-bV<N ...>
	s/\^(R-bV[^ ]*) +<(QP-EXT)([^>]*)>\^/\^\1 <Q \3>\^/&&($j=31)||
	s/\^(R-bV) +<(NP) +([^>]*)> <DEV +([^>]*)>\^/\^\1 <N \3> <R-bV-aN \4>\^/&&($j=552)||

	s/\^(R-bV) +(<DT[^>]*>) +(<QP[^>]*>)\^/\^\1 <N \2 \3>\^/&&($j=433)||
	s/\^(R-bV[^ ]*) +<(VP)([^>]*)> +<(DEV)([^>]*)>\^/\^\1 <V-aN\3> <R-bV-a{V-aN}\5>\^/&&($j=107)||
        s/\^(R-bV[^ ]*) +<(ADVP[^ ]*)([^>]*)> +<(DEV)([^>]*)>\^/\^\1 <R-bV\3> <R-bV-a{R-bV}\5>\^/&&($j=191)||
        s/\^(R-bV) +<(AD) +([^>]*)> +<(AD) +([^>]*)>\^/\^\1 <R-bV-b{R-bV} \3> <R-bV \5>\^/&&($j=367)||
        #s/\^(R-bV) +<(P) +([^>]*)> +<(IP) +([^>]*)>\^/\^\1 <R-bV-bV \3> <V \5>\^/&&($j=414)||
	
        #N<CD ...>< CLP ...> --> N<C...><A-bC ...>
	s/\^(Q) +<(CD|OD)([^>]*)> +<(CLP[^ ]*) +([^>]*)>\^/\^Q <C\3> <Q-aC \5>\^/&&($j=32)||
	s/\^(Q) +<(CD)([^>]*)> +<M +([^>]*)>\^/\^Q <C\3> <Q-aC \4>\^/&&($j=452)||
	s/\^(Q) +<QP[^ ]* +(\[NP[^>]*)> +(<NP[^>]*>|<NN[^>]*>)\^/\^\1 <A-bN \[Q \2\]> <N \3\4>\^/&&($j=509)||
	s/\^(Q) +<(QP) +(\[CD[^>]*CC[^>]*\[CD[^>]*)> +<NP +([^>]*)>\^/\^Q <C \3> <Q-aC \4>\^/&&($j=603)||
	s/\^(Q) +<QP[^ ]* +([^>]*)> +(.*)(<NP[^>]*>|<NN[^>]*>)\^/\^\1 <Q-bN \2> <N \3\4>\^/&&($j=71)||
	s/\^(Q-bN[^ ]*) +<(CD|OD)([^>]*)> +<(CLP)([^>]*)>\^/\^\1 <C\3> <Q-bN-aC\5>\^/&&($j=72)||
	s/\^(Q-bN) +(<NP +[^>]*>) +<(QP) +([^>]*)>\^/\^\1 <A-bN \2> <\1 \4>\^/&&($j=530)||
#	s/\^(Q-bN) +<CD +([^>]*)> +<(NP) +([^>]*)>\^/\^\1 <\1-bN \2> <N \4>\^/&&($j=601)||

	s/\^(Q-bN) +<QP +([^>]*)> +(<QP +[^>]*>)\^/\^\1 <\1 \2> <\1-c{\1} \3>\^/&&($j=546)||
	s/\^(Q-bN-c{Q-bN}) +(<QP +[^>]*>)\^/\^\1 <Q-bN \2>\^/&&($j=547)||

	s/\^(Q-bN) +<QP +([^>]*)> +(<CC +[^>]*>|<PU +[^>]*>) +(<QP +[^>]*>)(.*)\^/\^\1 <\1 \2> <\1-c{\1} \3 \4\5>\^/&&($j=531)||
	s/\^Q-bN-c{(Q-bN)} +(<CC +[^>]*>|<PU +[^>]*>) +(<QP +[^>]*>)(.*)\^/\^\1-c{\1} <\1-c{\1}-d{\1} \2> <\1 \3\4>\^/&&($j=532)||       
	s/\^(Q-bN[^ ]*) +(<CD +[^>]*>) +(<CC +[^>]*>) +(<CD +[^>]*>) +<(CLP)([^>]*)>\^/\^\1 <C \2 \3 \4> <Q-bN-aC\6>\^/&&($j=372)||
	s/\^(C) +<CD +([^>]*)> +(<CC +[^>]*>) +(<CD +[^>]*>)\^/\^\1 <C \2> <C-cC \3 \4>\^/&&($j=373)||
	s/\^(Q) +(<CD +[^>]*>) +(<CC +[^>]*>) +(<CD +[^>]*>)\^/\^\1 <C \2 \3 \4>\^/&&($j=456)||
	s/\^(C-cC) +<CC +([^>]*)> +<CD +([^>]*)>\^/\^\1 <C-cC-dC \2> <C \3>\^/&&($j=374)||
	s/\^(A-bN) +(<JJ +[^>]*>) +(<CC +[^>]*>) +(<JJ +[^>]*>)\^/\^\1 <\1 \2> <\1-c{\1} \3 \4>\^/&&($j=501)||
	s/\^(A-bN)-c{A-bN} +<CC +([^>]*)> +<JJ +([^>]*)>\^/\^\1-c{\1} <\1-c{\1}-d{\1} \2> <\1 \3>\^/&&($j=502)||

	s/\^(Q-gN[^ ]*) +<(CLP)([^>]*)>\^/\^\1 <Q-bN\3>\^/&&($j=93)||
	s/\^(Q-bN) +<(M +[^>]*)>\^/\^\1 <Q-bN-aC [\2]>\^/&&($j=94)||
	s/\^(Q-bN) +<CLP +([^>]*)>\^/\^\1 <Q-bN-aC \2>\^/&&($j=410)||
	s/\^(Q-bN) +<JJ +([^>]*)> +<CLP +([^>]*)>\^/\^\1 <A-bN \2> <\1 \3>\^/&&($j=340)||
	s/\^(Q) +<(CD|OD)([^>]*)>\^/\^Q <C\3>\^/&&($j=166)||
	s/\^(Q) +<(ADVP[^ ]*)([^>]*)> +<QP +([^>]*)>\^/\^\1 <R-bV \3> <Q \4>\^/&&($j=170)||
	s/\^(Q-bN) +<(ADVP[^ ]*|LCP[^ ]*)([^>]*)> +<QP +([^>]*)>\^/\^\1 <R-bV \3> <\1 \4>\^/&&($j=309)||
	s/\^(Q-bN) +<(NP-PN)([^>]*)> +<QP +([^>]*)>\^/\^\1 <R-bV \[N \3\]> <\1 \4>\^/&&($j=604)||

	s/\^(Q) +<QP +([^>]*)> +<(ADVP[^ ]*)([^>]*)>\^/\^\1 <Q \2> <R-bV \4>\^/&&($j=203)||
	s/\^(Q-bN[^ ]*) +<(ADJP) +([^>]*)> +<(QP) +([^>]*)>\^/\^\1 <A-bN \3> <\1 \5>\^/&&($j=257)||
	s/\^(Q-bN[^ ]*) +<(QP) +([^>]*)> +<(ADVP[^ ]*) +([^>]*)>\^/\^\1 <\1 \3> <R-bV \5>\^/&&($j=436)||
	s/\^(Q-bN[^ ]*) +<(ADJP) +([^>]*)> +<(CLP) +([^>]*)>\^/\^\1 <A-bN \3> <\1 \5>\^/&&($j=253)||
	#collaps V-fIP(IP ...)--> V-fIP ...
	s/\^(V|V-g{R-bV}) +<(IP[^ ]*) +([^>]*)>\^/<\1 \3>/&&($j=127)||
	s/\^(V-aN) +<(IP-OBJ) +([^>]*\*PRO\*[^>]*)>\^/<\1 \3>/&&($j=207)||
	s/\^(V) +<(IP) ([^>]*)>\^/<\1 \3>/&&($j=15)||
	#corretion of mis-tagged QP coordination
	s/\^(Q-bN[^ ]*) +<QP +(\[CD +[^>]*\])> +(<PU[^>]*>) +<QP +(\[CD +[^>]*\]) +\[CLP +([^>]*\])\]>\^/\^\1 <C \2 \3 \4> <Q-bN-aC \5>\^/&&($j=350)||
	s/\^(C) +<CD +([^>]*)> +(<PU[^>]*>) +(<CD +[^>]*>)\^/\^\1 <C \2> <C-cC \3 \4>\^/&&($j=351)||
	s/\^(C-cC) +(<PU[^>]*>) +<CD +([^>]*)>\^/\^\1 \2 <C \3>\^/&&($j=352)||

	#add a hypothesized advertial phrase
	#s/\^(V-g{R-bV}) +(<NP[^>]*>) +(<VP[^>]*>)\^/\^\1 <V \2 \3>\^/&&($j=185)||
	#V-gN < IP ...> --> V-gN <..>
	#s/\^(V-gN[^ ]*) +<(IP) ([^>]*)>\^/<\1 \3>/&&($j=38)||

	#collaps V-aN(VP ...)--> V-aN ...
	s/\^(V-aN[^ ]*) +<(VP|VRD|VSB|PP-PRD|VPT|NP-PRD|VP-WH) +([^>]*)>\^/<\1 \3>/&&($j=7)||
	s/\^(V-aN) +<(NP) +(\[QP[^>]*)>\^/\^ \1 <Q \3>\^/&&($j=516)||
	s/\^(E-gN|B-aN[^ ]*) +<(VP) +([^>]*)>\^/<\1 \3>/&&($j=453)||
	#collaps N (NP ...) --> N
	s/\^(N-cN) +<NR +([^>]*)>\^/\^\1 <N \2>\^/&&($j=577)||

       	s/\^(N[^ ]*) +<(NN|NR|NP-PN[^ ]*|NP-OBJ[^ ]*|NT|NP-TTL|LCP|NP-PRD|PN|NP|NP-WH-PRD|NP-EXT|LCP-OBJ|LCP-SBJ|FW|LC|NP-IO|NP-SBJ[^ ]*|NP-APP|NP[^ ]*PN|DP-OBJ|DP|DT|NP-WH-OBJ) ([^>]*)>\^/<\1 \3>/&&($j=20)||
	#collaps V-aN
	s/\^(V-aN-b{V-aN}-gN) +<(VV) ([^>]*)>\^/\^\1 <V-aN-b{V-aN}-bN \3>\^/&&($j=548)||

	s/\^(V[^ ]*) +<(VV) ([^>]*)>\^/<\1 \3>/&&($j=21)||
	s/\^(V-aN-bN) +<(VE) ([^>]*)>\^/<\1 \3>/&&($j=158)||
	s/\^(V-aN-bV) +<(VC) ([^>]*)>\^/<\1 \3>/&&($j=453)||
	s/\^(V-aN) +<(VA|AD|NN|PP-PRP|VP-PRD|VE|VPT)[^ ]* ([^>]*)>\^/<\1 \3>/&&($j=92)||
	s/\^(B-aN-aN-bN) +<(VRD|VV|VCP|VSB|VCD) ([^>]*)>\^/<\1 \3>/&&($j=133)||
        #this collaps only happen in annotating object-control verbs
	s/\^(V-aN) +<(IP[^ ]*) ([^>]*\*PRO\*[^>]*)>\^/<\1 \3>/&&($j=122)||
        s/\^(V-aN) +<(IP[^ ]*) (\[NP[^ ]*SBJ \[-NONE-[^>]*)>\^/<\1 \3>/&&($j=122)||
	s/\^(V-aN) +<NP[^ ]*SBJ +[^>]*-NONE-[^>]*> +<VP +([^>]*)>\^/<\1 \2>/&&($j=348)||
	s/\^(A-bN-aC[^ ]*) +<(M) ([^>]*)>\^/<\1 \3>/&&($j=29)||
	s/\^(Q-aC[^ ]*) +<(M|NN) ([^>]*)>\^/<\1 \3>/&&($j=33)||
	s/\^(N-bQ[^ ]*) +<(DT) ([^>]*)>\^/<\1 \3>/&&($j=91)||
	s/\^(N-aN) +<(LC) ([^>]*)>\^/<\1 \3>/&&($j=102)||
	s/\^(Q-bN[^ ]*) +<(CD|OD) ([^>]*)>\^/<\1 \3>/&&($j=81)||
	s/\^(Q-bN-aC[^ ]*) +<(M) ([^>]*)>\^/<\1 \3>/&&($j=73)||	
	s/\^(N-cN[^ ]*) +<(JJ|ETC|DT) ([^>]*)>\^/<\1 \3>/&&($j=37)||
	s/\^(A-bN) +<(NR|NT) +([^>]*)>\^/\^\1 <N \3>\^/&&($j=560)||

	s/\^(A-bN) +<(JJ|DT|AD|ADJP|LKK) ([^>]*)>\^/<\1 \3>/&&($j=51)||
	s/\^(A-bN-bN) +<(AD) ([^>]*)>\^/<\1 \3>/&&($j=51)||
	s/\^(A-bN-aN[^ ]*|A-bN-a{A-bN}|A-bN-a{R-bV}) +<(DEG) ([^>]*)>\^/<\1 \3>/&&($j=48)||
	s/\^(R-bV[^ ]*) +<(AD|LCP-TMP|LCP|CS|LCP-EXT|ADVP[^ ]*|NP|VP|VV|CC|DT|JJ) +([^>]*)>\^/<\1 \3>/&&($j=55)||
	s/\^(R-bV[^ ]*) +<(PP[^ ]*) ([^>]*)>\^/<\1 \3>/&&($j=67)||
#	s/\^(D-aV) +<(DEC) ([^>]*)>\^/<\1 \3>/&&($j=558)||
	
	s/\^(A-bN-a\{V-gN\}[^ ]*) +<(DEC) ([^>]*)>\^/<\1 \3>/&&($j=62)||
	s/\^(Q|Q-bN) +<(QP[^ ]*) ([^>]*)>\^/<\1 \3>/&&($j=239)||


	#V-aN(ADVP[^ ]*[^ ]*|PP...)(VP ...) --> V-aN(R-bV ...)(V-aN ...)

	s/\^(V-aN-g{R-bV}) +<(PP[^ ]*|NP-MNR[^ ]*|NP-PRP[^ ]*) +[^>]*-NONE- \*T\*[^>]*> +(.*<V[^>]*>)\^/\^\1 <V-aN \3>\^/&&($j=315)||
	s/\^(V-aN[^ ]*) +<(NP-DIR|NP-MNR) +([^>]*)> +<VP +([^>]*)>\^/\^\1 <R-bV \[N \3\]> <\1 \4>\^/&&($j=535)||

	s/\^(V|V-aN[^ ]*|V-g[^ ]*|E-[^ ]*|B-aN[^ ]*) +(<ADVP[^ ]* +[^>]*>|<PP[^ ]* +[^>]*>|<IP-ADV[^ ]* +[^>]*>|<DVP[^ ]* +[^>]*>|<CP-ADV[^ ]* +[^>]*>) (<PU [^>]*>) (.*)\^/\^\1 <R-bV \2 \3> <\1 \4>\^/&&($j=468)||
	#PP-SBJ as NP
#	s/\^(V-aN-g{R-bV}) +<(PP[^ ]*|NP-MNR[^ ]*|NP-PRP[^ ]*) +[^>]*-NONE- \*T\*[^>]*> +(.*<VP[^>]*>)\^/\^\1 <V-aN \3>\^/&&($j=315)||
	s/\^(V|V-aN[^ ]*|V-g[^ ]*|E-[^ ]*|B-aN[^ ]*) +<PP-SBJ +([^>]*)> +(<VP +[^>]*>)\^/<\1 \[NP-SBJ \2\] \3>/&&($j=495)||
	s/\^(V|V-aN[^ ]*|V-g[^ ]*|E-[^ ]*|B-aN[^ ]*) +<(ADVP[^ ]*|PP[^ ]*|IP-ADV|IP-TMP|IP-CND|CP-ADV) +([^>]*)> (.*)\^/\^\1 <R-bV [\2 \3]> <\1 \4>\^/&&($j=10)||
	s/\^(V-aN[^ ]*|V-g[^ ]*) +<VV +([^>]*)> +(<(ADVP[^ ]*|PP) +[^>]*>)\^/\^\1 <\1 \2> <R-bV \3>\^/&&($j=380)||
	s/\^(R-bV) +(<PP +[^>]*>) +(<PU +[^>]*>) +(<CC +[^>]*>) +(<PP +[^>]*>)\^/\^\1 <R-bV \2 \3> <\1-c{\1} \4 \5>\^/&&($j=381)||
	s/\^(R-bV)-c{R-bV} +<CC +([^>]*)> +<PP +([^>]*)>\^/\^\1 <\1-c{\1}-d{\1} \2> <\1 \3>\^/&&($j=382)||
	s/\^(V) +(<CP-ADV +[^>]*>) +(<PU +[^>]*>) +(.*)\^/\^\1 <R-bV \2 \3> <\1 \4>\^/&&($j=203)||
	s/\^(R-bV) +<(CP-ADV) +([^>]*)> +(<PU +[^>]*>)\^/\^\1 <\1 \3> \4\^/&&($j=204)||
	s/\^(R-bV) +(<QP-TMP +[^>]*>) +(<PU +[^>]*>)\^/\^\1 <\1 \2> \3\^/&&($j=234)||
	s/\^(R-bV) +<QP-TMP +([^>]*)>\^/\^\1 <Q \2>\^/&&($j=236)||
	s/\^(R-bV) +(<QP +[^>]*>) +(<NP +[^>]*>)\^/\^\1 <N \2 \3>\^/&&($j=242)||
	s/\^(R-bV) +<ADVP[^ ]* +([^>]*)> +<LC +([^>]*)>\^/\^\1 <R-bV \2> <\1-a{R-bV} \3>\^/&&($j=604)||
	s/\^(R-bV) +<P +([^>]*)> +<(LCP[^ ]*|NN) +([^>]*)>\^/\^\1 <R-bV-bN \2> <N \4>\^/&&($j=605)||
	s/\^(R-bV) +<PP[^ ]* +([^>]*)> +(.*)\^/\^\1 <\1 \2> <\1 \3>\^/&&($j=606)||

	s/\^(R-bV) +<ADVP[^ ]* +([^>]*)> +<IP +([^>]*)>\^/\^\1 <\1-bV \2> <V \3>\^/&&($j=205)||
	s/\^(R-bV) +<ADVP[^ ]* +([^>]*)> +<QP +([^>]*)>\^/\^\1 <R-bV-bQ \2> <Q \3>\^/&&($j=460)||
	s/\^(R-bV) +<ADVP[^ ]* +([^>]*)> +<ADVP +([^>]*)>\^/\^\1 <\1-b{\1} \2> <\1 \3>\^/&&($j=532)||
	s/\^(R-bV) +<ADVP[^ ]* +([^>]*)> +(<PU +[^>]*>|<CC +[^>]*>) +(<ADVP +[^>]*>)(.*)\^/\^\1 <\1 \2> <\1-c{\1} \3 \4\5>\^/&&($j=533)||
	s/\^R-bV-c{(R-bV)} +(<PU +[^>]*>|<CC +[^>]*>) +(<ADVP +[^>]*>)(.*)\^/\^\1-c{\1} <\1-c{\1}-d{\1} \2> <\1 \3\4>\^/&&($j=534)||

	s/\^(V-[^ ]*) +<NP-ADV +([^>]*)> (.*)\^/\^\1 <R-bV \2> <\1 \3>\^/&&($j=22)||
	#s/\^(V[^ ]*) +<VV +([^>]*)> +(<AD +[^>]*>) +(<VV +[^>]*>)\^/\^\1 <\1 \2> <\1 \3 \4>\^/&&($j=184)||

	#V <PP...> <PU...> <...> --> V R-bV(<PP ...> <PU ...>) V(<...>)
	s/\^(V[^ ]*) +(<PP[^ ]* +[^>]*>) +(<PU +[^>]*>) +(.*)\^/\^\1 <R-bV \2 \3> <\1 \4>\^/&&($j=97)||
	s/\^(V[^ ]*) +<DP-ADV +([^>]*)> (.*)\^/\^\1 <R-bV \2> <\1 \3>\^/&&($j=25)||
	s/\^(V[^ ]*) +<PP-PRP +([^>]*)> (.*)\^/\^\1 <R-bV \2> <\1 \3>\^/&&($j=39)||
	s/\^(V[^ ]*) +<(LCP-TMP|LCP-LOC) +(\[NP[^>]*)> (.*)\^/\^\1 <R-bV [N \3]> <\1 \4>\^/&&($j=58)||
	s/\^(V[^ ]*) +<(LCP-LOC|LCP-ADV) +([^>]*)> +(.*)<VP +([^>]*)>\^/\^\1 <R-bV \3> <\1 \4\5>\^/&&($j=243)||
	s/\^(V[^ ]*) +(<LCP-TMP +[^>]*>|<LCP +[^>]*>|<QP-TMP +[^>]*>) +(<PU[^>]*>) (.*)\^/\^\1 <R-bV \2 \3> <\1 \4>\^/&&($j=112)||
	s/\^(V-aN|V-aN-gN) +(<LCP-TMP +[^>]*>|<LCP +[^>]*>|<QP-TMP +[^>]*>|<PP-BNF[^>]*>) +(.*)(<VP[^>]*>)\^/\^\1 <R-bV \2> <\1 \3\4>\^/&&($j=473)||
	s/\^(R-bV[^ ]*|N) +(<LCP-TMP +[^>]*>|<LCP +[^>]*>|<LCP-SBJ +[^>]*>) (<PU[^>]*>)\^/\^\1 <\1 \2> \3\^/&&($j=139)||
	s/\^(V|V-aN) +(<PU[^>]*>) +(.*)\^/\^\1 \2 <\1 \3>\^/&&($j=171)||
	s/\^(V) +(.*) +(<PU[^>]*>) ?\^/\^\1 <\1 \2> \3\^/&&($j=301)||
	s/\^(V) +<QP-TMP +([^>]*)> +(<NP-SBJ +[^>]*>) +(.*)(<VP +[^>]*>)\^/\^\1 <R-bV [Q \2]> <\1 \3 \4\5>\^/&&($j=336)||
	s/\^(V-g{R-bV})([^ ]*) +<NP[^ ]*LOC +[^>]*-NONE- \*T\*[^>]*> +(<IP[^ ]* +[^>]*>)\^/\^\1\2 <V\2 \3>\^/&&($j=461)||
	s/\^(V[^ ]*) +<(NP-LOC|DP-TMP|NP-PN-LOC) +([^>]*)> (.*)\^/\^\1 <R-bV [N \3]> <\1 \4>\^/&&($j=60)||
	s/\^(V[^ ]*) +<(LCP-TMP) +([^>]*)> +(.*)\^/\^\1 <R-bV \3> <\1 \4>\^/&&($j=330)||
	s/\^(V-aN) +(<VV +[^>]*>) +(<AS +[^>]*>) +<(LCP-EXT) +([^>]*)>\^/\^\1 <\1 \2 \3> <R-bV \5>\^/&&($j=330)||
	s/\^(V-aN) +(<VV +[^>]*>) +(<AS +[^>]*>) +(<QP-EXT +[^>]*>)\^/\^\1 <\1 \2 \3> <R-bV \4>\^/&&($j=474)||
	s/\^(V-aN)-c{V-aN} +<(PU +[^>]*)> +(.*)\^/\^\1-c{\1} <\2> <\1 \3>\^/&&($j=23)||
	s/\^(V-c{V}) +<(PU +[^>]*)> +(<IP +[^>]*>)(.*)\^/\^\1 <\2> <V \3\4>\^/&&($j=405)||
	s/\^(V) +<(CP[^ ]*|IP[^ ]*) +([^>]*)> +(<PU[^>]*>) +(<IP[^ ]* +[^>]*>|<CP[^ ]* +[^>]*>)(.*)\^/\^\1 <V \3> <V-c{V} \4 \5\6>\^/&&($j=546)||
	s/\^(V) +<IP[^ ]* +([^>]*)> <SP +([^>]*)>\^/\^\1 <V \2> <R-bV \3>\^/&&($j=547)||
	s/\^(V-aN) +(<VV[^ ]* +[^>]*>.*) <SP +(了)>\^/\^\1 <\1 \2> <R-bV \3>\^/&&($j=548)||
	s/\^(V-aN) +(<VV[^ ]* +[^>]*>) +(<AS[^>]*>) +<(NP-EXT|PP[^ ]*) +([^>]*)>\^/\^\1 <\1 \2 \3> <R-bV \5>\^/&&($j=549)||
	s/\^(V-aN) +(<VV[^ ]* +[^>]*>) +(<NP-OBJ[^>]*>) +<(NP-EXT|PP[^ ]*) +([^>]*)>\^/\^\1 <\1 \2 \3> <R-bV \5>\^/&&($j=550)||
	s/\^(V-aN) +<(LCP-PRD|NP-PN-PRD) +([^>]*)>\^/\^\1 <N \3>\^/&&($j=553)||

	s/\^(V-c{V}) +<(PU +[^>]*)> +(<CP[^ ]* +[^>]*>|<IP[^ ]* +[^>]*>)(.*)\^/\^\1 <\2> <V \3\4>\^/&&($j=406)||
	s/\^(V[^ ]*) +<(PU +[^>]*)> +(.*)\^/\^\1 <\2> <\1 \3>\^/&&($j=79)||
	s/\^(V-aN[^ ]*) +<VP[^ ]* +(.*\[ADVP +\[AD 一[^>]*)> (<VP[^>]*>)\^/\^\1 <R-bV \2> <\1 \3>\^/&&($j=68)||
	s/\^(V-aN[^ ]*) +<VV[^ ]* +(没有)> (<VP[^>]*>)\^/\^\1 <R-bV \2> <\1 \3>\^/&&($j=70)||
	s/\^(V-aN[^ ]*) +(<VV[^ ]*[^>]*>)(.*) +(<PU[^>]*>)\^/\^\1 <\1 \2\3> \4\^/&&($j=114)||
	s/\^(V-aN) +(<VV +[^>]*>|<VSB +[^>]*>|<VRD +[^>]*>) +(<PU +[^>]*>) +<IP[^ ]* +([^>]*)>\^/\^\1 <V-aN-bV \2 \3> <V \4>\^/&&($j=173)||
	s/\^(V-aN|B-aN[^ ]*|E-aN[^ ]*) +(<VV +[^>]*>) +<PP-LOC +([^>]*)>\^/\^\1 <\1 \2> <R-bV \3>\^/&&($j=194)||
	s/\^(V-aN) +<QP-ADV +([^>]*)> +(.*)\^/\^\1 <R-bV [Q \2]> <V-aN \3>\^/&&($j=329)||
	s/\^(V-aN-bV) +<VV +([^>]*)> +<VV +([^>]*)>\^/\^\1 <V-aN-bV \2> <\1-c{\1} \[\1 \3]>\^/&&($j=219)||

#	s/\^(V-aN-bV) +<VV +([^>]*)> +<VV +([^>]*)>\^/\^\1 <V-aN-bN \2> <\1-a{\1} \3>\^/&&($j=219)||
	s/\^(V-aN) +<VV +([^>]*)> +(<CC +[^>]*>) +(<VV +[^>]*>)\^/\^\1 <\1 \2> <\1-c{\1} \3 \4>\^/&&($j=307)||
	#s/\^(V-aN[^ ]*) +<(PU +[^>]*)> (.*)\^/\^\1 <\2> <\1 \3>\^/&&($j=49)||
	s/\^(V[^ ]*) +(<DP-TPC +[^>]*>) (.*)\^/\^\1 <R-bV \2> <\1 \3>\^/&&($j=35)||
	

	#R-bV (P...)(NP...)--> R-bV(R-bV-bN ...)(N...)
	s/\^(R-bV[^ ]*) +<(P)([^>]*)> +<(NP[^>]*)>\^/\^\1 <R-bV-bN\3> <N [\4]>\^/&&($j=11)||
        #R-bV (P...)(IP...)--> R-bV(R-bV-bN ...)(V...)
	s/\^(R-bV[^ ]*) +<(P)([^>]*)> +<IP[^ ]* +([^>]*)>\^/\^\1 <R-bV-bV\3> <V \4>\^/&&($j=24)||
	s/\^(R-bV[^ ]*) +<(P)([^>]*)> +<(LCP|DP) +([^>]*)>\^/\^\1 <R-bV-bN\3> <N \5>\^/&&($j=151)||
	s/\^(R-bV[^ ]*) +<(P)([^>]*)> +<(QP) +([^>]*)>\^/\^\1 <R-bV-bQ\3> <Q \5>\^/&&($j=464)||
	s/\^(R-bV[^ ]*) +<(DP-TPC)([^>]*)>\^/\^\1 <N\3>\^/&&($j=53)||
        #R-bV*<DT CLP> --> R-bV<N-bN [DT..] [CLP]>
	s/\^(R-bV[^ ]*) +<(DT)([^>]*)> +<(CLP[^>]*)>\^/\^\1 <N [\2\3] [\4]>\^/&&($j=26)||
	s/\^(Q) +<(DP)([^>]*)> +<QP +([^>]*)>\^/\^\1 <R-bV \3> <\1 \4>\^/&&($j=507)||
	s/\^(R-bV[^ ]*) +<(NP[^ ]*) +([^>]*)> +<LC +([^>]*)>\^/\^\1 <N \3> <R-bV-aN \4>\^/&&($j=248)||
	s/\^(R-bV[^ ]*) +<(ADVP)([^>]*)> +<(PP[^>]*)>\^/\^\1 <R-bV \3> <R-bV [\4]>\^/&&($j=66)||
	s/\^(R-bV[^ ]*) +<(ADVP) +(\[AD 一[^>]*)> +<(VP[^>]*)>\^/\^\1 <R-bV-b{V-aN} 一> <V-aN [\4]>\^/&&($j=69)||
	s/\^(R-bV[^ ]*) +<(IP-ADV|IP-TMP|CP-ADV) +([^>]*)> <(PU[^>]*)>\^/\^\1 <\1 [V \3]> <\4>\^/&&($j=98)||
	s/\^(R-bV) +<(CP-ADV) +([^>]*)>\^/<\1 \3>/&&($j=556)||

	s/\^(R-bV[^ ]*) +<(PP[^ ]*|ADVP) +([^>]*)> <(PU[^>]*)>\^/\^\1 <\1 \3> <\4>\^/&&($j=98)||
	s/\^(R-bV[^ ]*) +<(IP) +([^>]*)> <LC([^>]*)>\^/\^\1 <V \3> <R-bV-a{V}\4>\^/&&($j=113)||
	s/\^(R-bV[^ ]*) +(<(QP) +[^>]*>) <LC([^>]*)>\^/\^\1 <N \2> <R-bV-aN\4>\^/&&($j=172)||
	s/\^(R-bV[^ ]*) +<(NN|NT) +([^>]*)>\^/\^\1 <N \3>\^/&&($j=161)||
	
	#N-bN <DT .. CLP> --> N-bN<N-bN-b(A-bN).. A-bN>
	s/\^(N[^ ]*) +<(DT)([^>]*)> +<(CLP[^>]*)>\^/\^\1 <N-bQ \3> <Q [\4]>\^/&&($j=27)||
	s/\^(N[^ ]*) +(<CLP +[^>]*>) +(<NP +[^>]*>)\^/\^\1 <Q \2 \3>\^/&&($j=330)||
        s/\^(Q) +<CLP +([^>]*)> +<NP +([^>]*)>\^/\^\1 <Q-bN \2> <N \3>\^/&&($j=331)||
	#A-bN <CLP [M ]> --> A-bN <A-bN-aC [M ..]> where the number word is implied 
	s/\^(Q) +<(CLP)([^>]*)>\^/\^\1 <Q-aC \3>\^/&&($j=28)||
	s/\^(Q-aC) +<ADJP +([^>]*)> +<(CLP) +([^>]*)>\^/\^\1 <A-bN \2> <\1 \4>\^/&&($j=597)||

	#delete empty category
	s/ \^(N|N-gN|N-gN-\d+|N-\d+|Q|R-bV) +(<-NONE- \*pro\*>|<-NONE- \*PRO\*>|<-NONE- \*-\d>|<-NONE- \*T[^>]*>|<-NONE- \*RNR[^>]*>)\^//&&($j=156)||
	s/ \^R-bV +<Q \[-NONE- \*RNR\*-\d\]>\^//&&($j=508)||
	#s/ \^Q-aC +<-NONE- \*T\*[^>]*>\^//&&($j=529)||

	s/ \^(N[^ ]*) +<N \[N[^ ]* \[-NONE- \*(pro|T)\*[^ ]*\^//&&($j=444)||
	
	#misc
        s/\^(V[^ ]*) +(<LST +[^>]*>) +(.*)\^/\^\1 \2 <\1 \3>\^/&&($j=307)||
	s/\^(LST) +<PU +([^>]*)>\^/<PU \2>/&&($j=308)||
	
	#PU
	#s/\^(V) +(<PU[^>]*>) +(.*)\^/\1 \2 <\1 \3>\^/&&($j=173)||

	#annotate IP-SBJ, as (N (V ...)), add unary rule V-->N
	#s/\^(IP-SBJ |IP-OBJ )(.*)\^/\^N <IP \2>\^/&&($j=2) ||
	#s/\^(IP-OBJ )(.*)\^/\^NP-OBJ <IP \2>\^/&&($j=3) ||

	#IP-TPC as (N-TPC (V ...)), add unary rule V--> N-TPC
	#s/\^(IP-TPC )(.*)\^/\^NP-TPC <IP \2>\^/&&($j=3) ||
	#IP-ADV as (R-bV (V...))
	#s/\^(IP-ADV)(.*)\^/\^R-bV <IP \2>\^/&&($j=4) ||
#        s/\^IP([^ ]* )<(NP-SBJ)([^>]*)> (.*)\^/\^V-fIP\1<N\3> <V-aN \4>\^/&&($j=1)||

	#subject as N, VP as V-aN
#	s/\^(V[^ ]* )<(NP-SBJ)([^>]*)> (.*)\^/\^\1<N\3> <V-aN \4>\^/&&($j=5)||
#        (s/\^(N-aD)([^ ]*?)(-[ir][^- \}]*)?([^ ]*) <(W[^>]*)> (<.*)\^/\^\1\2\3\4 <A-aN-x\3-lM-f\5> <N-aD-lI-fNIL \6>\^/ && ($j=171)) ||
#        (s/\^(N-aD)([^ ]*?)(-[ir][^- \}]*)?([^ ]*) <([^>]*)> (<.*)\^/\^\1\2\3\4 <A-aN-x-lM-f\5> <N-aD\3-lI-fNIL \6>\^/ && ($j=172)) ||
#        s/\^(N-aD)([^ ]*) <([^>]*)> (<.*)\^/\^\1\2 <A-aN-x-lM-f\3> <NP-lI-fNIL \4>\^/ ||
#        (s/\^(X-cX-dX)([^ ]*) <([^>]*)> (<.*)\^/\^\1\2 <\1-lM-f\3> <\1-lI-fNIL \4>\^/ && ($j=173)) ||
#        (s/\^(X-cX-dX)([^ ]*) ([^<>]*)\^/\^X-cX-dX\2 \3\^/ && ($j=174)) ||

        1 ) {
           	if ($j==0) {
#           		while( s/\^(.*)<NP(.*)\^/\^\1<N\2\^/ && ($j=0.1) ) {}  #(this is to fix sent 12157)
#        		while( s/\^(.*)<NN(S|P)? (.*)\^/\^\1<NP\2 \3\^/ && ($j=0.2) ) {}  #(this is to fix sent 7919)
        	}
        	debug($step, " used rule $j")
        }

    ######################################################################
    ## C. ADJUST BRACKETS OF CONSTITUENTS WITHIN NEWLY-INSERTED CONSTITUENTS

    while (
           #### uh-oh, turn each minimal <...> pair within other <...> into [...]
           s/(<[^>]*)<([^<>]*)>/\1\[\2\]/ ||
           0 ) {}

    ######################################################################
    ## D. PROPAGATE GAPS AND RELATED TAGS DOWN

   	$k = 0;
    while (
	   debug($step, "?? $_") ||

           #### -g/h/i (gap/trace tags)
           # propagate -g gap tag from parent to each child dominating trace with matching index
           (s/\^([^ \{]*-iN)(-g{[VC]-rN})(-[0-9]+)((?![0-9]).*) <((?![^ ]*\2\3)[^ ]*?)(-[fghjlpi][^>]*\[-NONE- *\*(?:T|ICH|INTERNAL)\*\3\][^>]*)>(.*)\^/\^\1\2\3\4 <\5\2\3\6>\7\^/  && ($k=0.5)) ||
           (s/\^([^ \{]*-iN)(-g[^- ]*)(-[0-9]+)((?![0-9]).*) <((?![^ ]*\2\3)[^ ]*?)(-[fghjlpi][^>]*\[-NONE- *\*(?:T|ICH|INTERNAL)\*\3\][^>]*)>(.*)\^/\^\1\2\3\4 <\5\2\3\6>\7\^/  && ($k=1)) ||
           (s/\^([^ \{]*)(-g{[VC]-rN})(-[0-9]+)((?![0-9]).*) <((?![^ ]*\2\3)[^ ]*?)(-[fghjl][^>]*\[-NONE- *\*(?:T|ICH|INTERNAL)\*\3\][^>]*)>(.*)\^/\^\1\2\3\4 <\5\2\3\6>\7\^/  && ($k=1.5)) ||
           (s/\^([^ ]*)(-g[^- \{\}]*|-g\{[^ \{\}]*\})(-[0-9]+)((?![0-9]).*) <((?![^ ]*\2\3)[^ ]*?)(-[fghjl][^>]*\[-NONE- *\*(?:T|ICH|INTERNAL)\*\3\][^>]*)>(.*)\^/\^\1\2\3\4 <\5\2\3\6>\7\^/  && ($k=2)) ||
           
           0 ) {
           	debug($step, " used rule k=$k")
           }

    ####################
    ## mark current as external...
    s/\^(.*?)\^/\(\1\)/;
    ## mark first unexpanded child as current...
    s/<(.*?)>/\^\1\^/;
  }

  ######################################################################
  ## III. REMOVE TEMPORARY ANNOTATIONS: EMPTY CATEGORIES, TRACE NUMBERS, ETC.

  # delete only empty cats for gaps with corresponding fillers
  while (
         # empty category deletion (quad)
         s/ \([^ ]*-[gh][^ ]*(-[0-9])+[^ ]* \([^ ]* \([^ ]* \([^ ]*-NONE- \*(?:T|ICH|RNR|INTERNAL)\*\1[^\)]*\)\)\)\)//g ||
         # empty category deletion (triple)
         s/ \([^ ]*-[gh][^ ]*(-[0-9])+[^ ]* \([^ ]* \([^ ]*-NONE- \*(?:T|ICH|RNR|INTERNAL)\*\1[^\)]*\)\)\)//g ||
         # empty category deletion (double)
         s/ \([^ ]*-[gh][^ ]*(-[0-9])+[^ ]* \([^ ]*-NONE- \*(?:T|ICH|RNR|INTERNAL)\*\1[^\)]*\)\)// ||
         # empty category deletion (single)
         s/ \([^ ]*-[gh][^ ]*(-[0-9])+[^ ]*-NONE- \*(?:T|ICH|RNR|INTERNAL)\*\1[^\)]*\)// ||
         # empty category deletion (double)
         s/ \([^ ]*-v[^ ]*[^ ]* \([^ ]*-NONE- \*(?:-[0-9]*)?\*?[^\)]*\)\)// ||
         #delete f-
         s/-f[A-Z]*//g ||
         # empty category deletion (single)
         s/ \([^ ]*-v[^ ]*[^ ]*-NONE- \*(?:-[0-9]*)?\*?[^\)]*\)// ||
         0 ) {}

  # remove trace numbers from gaps
  s/(-[gh]{[VC]-rN})-[0-9]+/\1/g;
  s/(-[gh]{?[A-Z](-a.)?}?)-[0-9]+/\1/g;
  # output
  print $_;
}
